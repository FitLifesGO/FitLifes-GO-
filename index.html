<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>FitLifes¬°GO! ‚Äî Tu App de Fitness & Dieta</title>
  <meta name="description" content="Aplicaci√≥n de fitness con seguimiento diario, planes, dietas y asistente." />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a2d9b5f2d5.js" crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <style>
    /* ==========================
        Estilos principales
       ========================== */
    :root{
      --bg: #0f1724; /* dark */
      --card: #0b1220;
      --muted: #9aa4b2;
      --accent: #2dd4bf; /* mint */
      --accent-2: #f59e0b; /* orange */
      --glass: rgba(255,255,255,0.03);
      --radius: 12px;
      --ff: 'Inter',system-ui,Arial;
    }
    [data-theme="light"]{
      --bg: #f6f8fa;
      --card: #ffffff;
      --muted: #4b5563;
      --accent: #059669;
      --accent-2: #ea580c;
      --glass: rgba(2,6,23,0.03);
    }

    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; font-family:var(--ff); background:var(--bg); color:var(--muted);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      transition:background .3s, color .3s;
    }

    /* Contenedor principal para manejar pesta√±as en m√≥vil */
    .app-section { display: none; }
    .app-section.active { display: block; }
    
    /* Header (Desktop) */
    header{display:flex;align-items:center;justify-content:space-between;padding:18px 28px;background:linear-gradient(180deg, rgba(0,0,0,0.06), transparent);backdrop-filter: blur(6px);position:sticky;top:0;z-index:40}
    .brand{display:flex;gap:12px;align-items:center;color:var(--accent)}
    .brand img { height: 30px; width: auto; }
    .brand h1{margin:0;font-size:1.1rem;color:inherit}

    .desktop-nav{display:flex;gap:12px;align-items:center}
    .desktop-nav a{color:var(--muted);text-decoration:none;padding:8px 12px;border-radius:8px; cursor:pointer;}
    .desktop-nav a:hover{background:var(--glass);color:inherit}

    .desktop-controls{display:flex;gap:10px;align-items:center}
    .btn{background:var(--accent);color:#042027;padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:600; text-decoration:none; display:inline-block; text-align:center;}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

    main{padding:28px;max-width:1200px;margin:18px auto}

    /* Hero */
    .hero{display:grid;grid-template-columns:1fr 420px;gap:18px;align-items:center;margin-bottom:22px}
    .hero .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:28px;border-radius:var(--radius)}
    .hero h2{margin:0 0 10px 0;color:var(--accent);font-size:1.8rem}
    .hero p{margin:0 0 18px 0;color:var(--muted)}
    .hero-buttons{display:flex;gap:10px;margin-top:12px}

    /* Grid for sections */
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .col-8{grid-column:span 8}
    .col-4{grid-column:span 4}
    .col-12{grid-column:span 12} /* Usado para simplificar la vista m√≥vil */

    /* Cards */
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 22px rgba(2,6,23,0.25)}
    h3{margin-top:0;color:var(--muted)}

    /* Plan and Diet Cards */
    .plans, .diet-list{display:flex;gap:12px;flex-wrap:wrap}
    .plan, .diet-card{flex:1 1 220px;padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    
    /* Formulario y Calculadora */
    .form-row{display:flex;gap:8px;margin-bottom:10px; flex-wrap: wrap;}
    input,select{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit; width:100%;}
    .form-row input, .form-row select {flex: 1;}

    /* Chat assistant */
    .chat{display:flex;flex-direction:column;height:320px}
    .chat .messages{flex:1;overflow:auto;padding:10px;display:flex;flex-direction:column;gap:8px}
    .msg{max-width:70%;padding:10px;border-radius:10px}
    .msg.user{align-self:flex-end;background:var(--accent);color:#002024}
    .msg.bot{align-self:flex-start;background:rgba(255,255,255,0.03)}
    .chat-input{display:flex;gap:8px;margin-top:8px}
    .chat-input input{flex:1}
    
    /* Footer & Credits */
    footer{padding:28px;text-align:center;color:var(--muted);margin-top: 30px;border-top: 1px solid var(--glass);}
    footer p { margin: 5px 0; }
    footer strong { color: var(--accent); }

    /* ====================
        Modales (Tutorial, Wizard, Detalles)
       ==================== */
    .modal-overlay { /* Estilos de Overlay y Modal Content omitidos por brevedad */ }
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex; align-items: center; justify-content: center;
      z-index: 100; backdrop-filter: blur(5px);
      opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .modal-overlay.visible { opacity: 1; visibility: visible; }
    .modal-content {
      background: var(--card); border-radius: var(--radius); width: 90%; max-width: 600px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
      transform: translateY(-30px) scale(0.95); opacity: 0;
      transition: transform 0.3s ease-out, opacity 0.3s ease-out;
      display: flex; flex-direction: column; max-height: 90vh;
    }
    .modal-overlay.visible .modal-content { transform: translateY(0) scale(1); opacity: 1; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 18px 28px; border-bottom: 1px solid var(--glass); }
    .modal-header h2 { margin: 0; color: var(--accent); font-size: 1.4rem; }
    .modal-close { background: none; border: none; color: var(--muted); font-size: 2.2rem; cursor: pointer; line-height: 1; padding: 0; }
    .modal-body { padding: 20px 28px; overflow-y: auto; }
    .modal-body ul { padding-left: 20px; margin-top: 0; }
    .modal-body strong { color: var(--accent-2); }
    .modal-footer { padding: 18px 28px; border-top: 1px solid var(--glass); display: flex; justify-content: flex-end; }
    .wizard-options .option { display:block; padding:12px 18px; border:1px solid var(--glass); border-radius:10px; margin-bottom:10px; cursor:pointer; }
    .wizard-options .option.selected { border-color:var(--accent); color:var(--accent); }


    /* ====================
        NUEVO: L√≥gica Responsive (Mobile First)
       ==================== */
    .desktop-nav, .desktop-controls, #mobile-menu-btn { display: none; } /* Ocultar en m√≥vil, manejado por bottom-nav */
    header { padding: 15px; }

    /* Barra de Navegaci√≥n Inferior (MOBILE) */
    #bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      display: flex; justify-content: space-around;
      background: var(--card); border-top: 1px solid var(--glass);
      box-shadow: 0 -4px 15px rgba(0,0,0,0.15);
      z-index: 50; padding: 0;
    }
    .nav-item {
      flex: 1; text-align: center; padding: 10px 0;
      text-decoration: none; color: var(--muted);
      font-size: 0.7rem; display: flex; flex-direction: column;
      align-items: center; cursor: pointer;
    }
    .nav-item i { font-size: 1.3rem; margin-bottom: 3px; }
    .nav-item.active { color: var(--accent); }

    main {
        padding: 15px;
        /* Espacio para la barra inferior en m√≥vil */
        padding-bottom: 70px;
    }

    /* Adaptar Tarjetas y Grid en M√≥vil */
    .hero { grid-template-columns: 1fr; }
    .hero .card { padding: 18px; }
    .hero-buttons { flex-direction: column; }
    .grid { display: block; } /* Apilar columnas */
    .col-8, .col-4 { grid-column: auto; }
    .diet-list, .plans { flex-direction: column; }
    .diet-card { flex-direction: row; text-align: left; }
    .diet-card .chart-wrap { margin: 0 10px 0 0; }
    .diet-card .diet-info { flex: 1; }
    .card { margin-bottom: 15px; }
    
    /* El chat debe adaptarse a la altura del m√≥vil */
    .app-section#asistente { height: 100vh; display: flex; flex-direction: column; }
    .app-section#asistente .card { flex: 1; display: flex; flex-direction: column; margin-bottom: 0; }
    .app-section#asistente .chat { flex: 1; height: auto; }
    .app-section#asistente .chat .messages { height: auto; }


    /* Media Query para Desktop (Revertir cambios) */
    @media (min-width: 900px) {
      /* Ocultar m√≥vil */
      #bottom-nav { display: none !important; }
      main { padding-bottom: 28px; }
      .app-section { display: block !important; }
      .app-section:not(#inicio) { display: none !important; }
      
      /* Mostrar Desktop */
      .desktop-nav, .desktop-controls { display: flex; }
      .hero{grid-template-columns:1fr 420px}
      .grid{display:grid}
      .col-8{grid-column:span 8}
      .col-4{grid-column:span 4}
      .app-section#asistente { height: auto; display: block; }
      .app-section#asistente .card { display: block; height: auto; }
      .app-section#asistente .chat { height: 320px; }
    }
  </style>
</head>
<body data-theme="dark">
  <header>
    <div class="brand">
        <img src="logos/FitLifesGoLOGO.png" alt="FitLifes¬°GO! Logo">
        <h1>FitLifes¬°GO!</h1>
    </div>
    
    <nav class="desktop-nav">
      <a data-target="inicio" class="nav-desktop active">Inicio</a>
      <a data-target="diario-tracker" class="nav-desktop">Diario</a>
      <a data-target="planes" class="nav-desktop">Planes</a>
      <a data-target="dietas" class="nav-desktop">Dietas</a>
      <a data-target="asistente" class="nav-desktop">Asistente</a>
      <a data-target="contacto-creditos" class="nav-desktop">Contacto</a>
    </nav>
    <div class="desktop-controls">
      <button id="themeToggle" class="btn secondary" title="Cambiar tema"><i class="fa-solid fa-moon"></i></button>
      <button id="openRegister" class="btn">Mi Perfil</button>
    </div>
  </header>

  <main>
    <div id="app-container">
        
        <section id="inicio" class="app-section active">
            <div class="hero">
                <div class="card" data-aos="fade-right">
                    <h2>Entrena con prop√≥sito, come con intenci√≥n</h2>
                    <p>Planes personalizados, calculadoras, seguimiento y un sistema visual de dietas con gr√°ficos para entender tus macros de forma r√°pida.</p>
                    <div class="hero-buttons">
                        <button class="btn" onclick="switchSection('planes')">Ver Planes</button>
                        <button class="btn secondary" onclick="switchSection('diario-tracker')">Mi Diario</button>
                    </div>
                </div>

                <div class="card" data-aos="fade-left">
                    <h3>Panel r√°pido</h3>
                    <p class="badge">IMC: <span id="imcValue">‚Äî</span></p>
                    <p style="margin-top:8px">Objetivo: <strong id="selectedGoal">...</strong></p>
                    <p style="margin-top:8px">Dieta seleccionada: <strong id="selectedDiet">...</strong></p>
                    <p style="margin-top:8px">Plan seleccionado: <strong id="selectedPlan">...</strong></p>
                    <div style="margin-top:12px">
                        <button class="btn" id="saveProfile">Guardar M√©tricas</button>
                        <button class="btn secondary" id="clearData">Borrar Todo</button>
                    </div>
                </div>
            </div>
            
            <div class="grid">
                 <div class="col-12" id="calculadora-inicio" data-aos="fade-up">
                    <div id="calculadora" class="card">
                        <h3>Mis M√©tricas</h3>
                        <p>Estos datos se usan para todas las calculadoras. Aj√∫stalos aqu√≠ o en el cuestionario.</p>
                        <div>
                            <div class="form-row">
                                <input id="age" type="number" placeholder="Edad" />
                                <select id="sex" onchange="checkCustomGender('sex')">
                                    <option value="male">Hombre</option><option value="female">Mujer</option><option value="other">Otro</option>
                                </select>
                                <input id="custom-gender-input-metrics" type="text" placeholder="¬øC√≥mo te identificas? (Opcional)" style="display:none;" />
                            </div>
                            <div class="form-row">
                                <input id="height" type="number" placeholder="Altura (cm)" />
                                <input id="weight" type="number" placeholder="Peso (kg)" />
                            </div>
                            <div style="display:flex;gap:8px;margin-top:8px">
                                <button class="btn" onclick="calculateCalories()">Calcular TMB</button>
                                <button class="btn secondary" onclick="saveProfile()">Guardar</button>
                            </div>
                            <p style="margin-top:12px">Tu TMB estimada: <strong id="tmb">‚Äî</strong></p>
                            <p>Calor√≠as objetivo: <strong id="targetCalories">‚Äî</strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="diario-tracker" class="app-section">
            <div class="grid">
                <div class="col-12" data-aos="fade-left">
                    <div id="tracker" class="card">
                        <h3>Seguimiento de Hoy</h3>
                        <div class="tracker-item">
                            <input type="checkbox" id="track-water">
                            <label for="track-water">Beb√≠ 2L de agua</label>
                        </div>
                        <div class="tracker-item">
                            <input type="checkbox" id="track-workout">
                            <label for="track-workout">Entren√© hoy</label>
                        </div>
                        <div class="tracker-item">
                            <input type="checkbox" id="track-diet">
                            <label for="track-diet">Segu√≠ mi dieta</label>
                        </div>
                        <hr style="border-color:var(--glass); margin: 12px 0;">
                        <div class="form-row">
                            <input type="number" id="track-calories" placeholder="Calor√≠as consumidas (ej: 1800)">
                            <input id="pesoInput" type="number" placeholder="Peso de hoy (kg)" />
                        </div>
                        <button class="btn" style="width:100%" onclick="completeDay()">Completar D√≠a y Guardar Peso</button>
                    </div>
                </div>
                
                <div class="col-12" data-aos="fade-up">
                    <div id="diario" class="card">
                        <h3>Mi Progreso y Historial</h3>
                        <h4>Gr√°fico de Peso</h4>
                        <canvas id="progressChart" height="100"></canvas>
                        
                        <h4 style="margin-top:15px;">Historial de Actividad</h4>
                        <div id="journal-log" class="journal-log">
                            <p>A√∫n no hay entradas.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="planes" class="app-section">
            <div class="grid">
                <div class="col-12" data-aos="fade-up">
                    <div class="card">
                        <h3>Planes de Entrenamiento (Todos Gratis)</h3>
                        <p>Selecciona el plan que se adapte a tu objetivo y visualiza los detalles.</p>
                        <div class="plans">
                            <div class="plan">
                                <h4>P√©rdida de peso</h4>
                                <p>Entrenamientos HIIT, 4x por semana...</p>
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
                                    <div class="price">Gratis</div>
                                    <button class="btn secondary" onclick="showPlanDetails('weight_loss')">Ver m√°s</button>
                                </div>
                            </div>
                            <div class="plan">
                                <h4>Aumento muscular</h4>
                                <p>Fuerza y volumen, 5x por semana...</p>
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
                                    <div class="price">Gratis</div>
                                    <button class="btn secondary" onclick="showPlanDetails('muscle_gain')">Ver m√°s</button>
                                </div>
                            </div>
                            <div class="plan">
                                <h4>Tonificaci√≥n</h4>
                                <p>Combinaci√≥n cardio-fuerza, 3x...</p>
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
                                    <div class="price">Gratis</div>
                                    <button class="btn secondary" onclick="showPlanDetails('toning')">Ver m√°s</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="dietas" class="app-section">
            <div class="grid">
                <div class="col-12" data-aos="fade-up">
                    <div class="card">
                        <h3>Planes de Dieta</h3>
                        <p>Revisa los perfiles de macronutrientes para elegir la dieta que mejor se alinee con tus objetivos.</p>
                        <div class="diet-list">
                            <div class="diet-card card" data-diet="balanced">
                                <div class="chart-wrap"><canvas id="chart-balanced" width="140" height="140"></canvas></div>
                                <div class="diet-info">
                                    <h4>Balanceada</h4> <p>Macros: <span class="badge">P 30% ‚Ä¢ C 45% ‚Ä¢ G 25%</span></p>
                                    <div style="margin-top:8px">
                                        <button class="btn" onclick="selectDiet('Balanceada', 'balanced')">Seleccionar</button>
                                        <button class="btn secondary" onclick="showDietDetails('balanced')">Detalles</button>
                                    </div>
                                </div>
                            </div>
                            <div class="diet-card card" data-diet="keto">
                                <div class="chart-wrap"><canvas id="chart-keto" width="140" height="140"></canvas></div>
                                <div class="diet-info">
                                    <h4>Cetog√©nica</h4> <p>Macros: <span class="badge">P 20% ‚Ä¢ C 10% ‚Ä¢ G 70%</span></p>
                                    <div style="margin-top:8px">
                                        <button class="btn" onclick="selectDiet('Cetog√©nica', 'keto')">Seleccionar</button>
                                        <button class="btn secondary" onclick="showDietDetails('keto')">Detalles</button>
                                    </div>
                                </div>
                            </div>
                            <div class="diet-card card" data-diet="vegan">
                                <div class="chart-wrap"><canvas id="chart-vegan" width="140" height="140"></canvas></div>
                                <div class="diet-info">
                                    <h4>Vegana</h4> <p>Macros: <span class="badge">P 25% ‚Ä¢ C 55% ‚Ä¢ G 20%</span></p>
                                    <div style="margin-top:8px">
                                        <button class="btn" onclick="selectDiet('Vegana', 'vegan')">Seleccionar</button>
                                        <button class="btn secondary" onclick="showDietDetails('vegan')">Detalles</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="asistente" class="app-section">
             <div class="grid">
                <div class="col-12" data-aos="fade-up">
                     <div class="card">
                        <h3>Asistente FitLifes¬°GO!</h3>
                        <div class="chat">
                          <div class="messages" id="messages"></div>
                          <div class="chat-input">
                            <input id="chatInput" placeholder="Preg√∫ntame algo..." />
                            <button class="btn" onclick="sendMessage()">Enviar</button>
                          </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="contacto-creditos" class="app-section">
            <div class="grid">
                <div class="col-12">
                    <section id="contacto" class="card" data-aos="fade-up">
                        <h3>Contacto</h3>
                        <form onsubmit="event.preventDefault();alert('Mensaje enviado (simulado)')">
                            <div class="form-row">
                                <input required placeholder="Nombre" />
                                <input required placeholder="Correo" type="email" />
                            </div>
                            <textarea required placeholder="Mensaje" style="width:100%;min-height:100px;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit"></textarea>
                            <div style="margin-top:10px"><button class="btn">Enviar</button></div>
                        </form>
                    </section>
                </div>
                <div class="col-12">
                     <section id="creditos" class="card" data-aos="fade-up">
                        <h3>Cr√©ditos</h3>
                        <p><strong>Escuela:</strong> CBTis N. 132, Hermosillo Sonora M√©xico</p>
                        <p><strong>Desarrolladores:</strong></p>
                        <ul>
                            <li>Jonathan Alexis Payan Enriquez</li>
                            <li>Sebastian Teran Rubio</li>
                        </ul>
                        <p><strong>Desarrollador Principal:</strong> Jesus Abraham Lopez Gutierrez</p>
                    </section>
                </div>
            </div>
        </section>

    </div> </main>

  <nav id="bottom-nav">
      <div class="nav-item active" data-target="inicio"><i class="fa-solid fa-house"></i>Inicio</div>
      <div class="nav-item" data-target="diario-tracker"><i class="fa-solid fa-chart-line"></i>Diario</div>
      <div class="nav-item" data-target="planes"><i class="fa-solid fa-dumbbell"></i>Planes</div>
      <div class="nav-item" data-target="dietas"><i class="fa-solid fa-apple-whole"></i>Dietas</div>
      <div class="nav-item" data-target="asistente"><i class="fa-solid fa-robot"></i>Asistente</div>
  </nav>

  <footer>
    <p>¬© 2025 FitLifes¬°GO! ‚Ä¢ CBTis Fit App ‚Ä¢ Pol√≠tica de Privacidad</p>
  </footer>

  <div id="wizard-modal" class="modal-overlay">
    <div class="modal-content">
      <div id="step-1" class="wizard-step active modal-body">
          <h2>¬°Bienvenido a FitLifes¬°GO!</h2>
          <p>Vamos a configurar tu perfil. Esto solo tomar√° un minuto y nos ayudar√° a personalizar tu experiencia.</p>
          <div class="wizard-nav"><span></span><button class="btn" onclick="nextStep(2)">Comenzar</button></div>
      </div>
      <div id="step-2" class="wizard-step modal-body">
          <h2>¬øCu√°l es tu objetivo principal?</h2>
          <div class="wizard-options">
              <div class="option" id="goal-lose" onclick="selectWizardOption('goal', 'lose')">Perder Peso</div>
              <div class="option" id="goal-maintain" onclick="selectWizardOption('goal', 'maintain')">Mantener Peso</div>
              <div class="option" id="goal-gain" onclick="selectWizardOption('goal', 'gain')">Ganar M√∫sculo</div>
          </div>
          <div class="wizard-nav"><button class="btn secondary" onclick="prevStep(1)">Atr√°s</button><button class="btn" onclick="nextStep(3)">Siguiente</button></div>
      </div>
      <div id="step-3" class="wizard-step modal-body">
          <h2>Cu√©ntanos sobre ti</h2>
          <p>Usaremos esto para calcular tus calor√≠as, IMC y TMB.</p>
          <div class="form-row">
              <input id="wiz-name" type="text" placeholder="Tu Nombre" />
              <select id="wiz-sex" onchange="checkCustomGender('wiz-sex')">
                  <option value="male">Hombre</option><option value="female">Mujer</option><option value="other">Otro</option>
              </select>
              <input id="custom-gender-input-wiz" type="text" placeholder="¬øC√≥mo te identificas? (Opcional)" style="display:none;" />
          </div>
          <div class="form-row">
              <input id="wiz-age" type="number" placeholder="Edad" />
              <input id="wiz-height" type="number" placeholder="Altura (cm)" />
              <input id="wiz-weight" type="number" placeholder="Peso (kg)" />
          </div>
          <div class="wizard-nav"><button class="btn secondary" onclick="prevStep(2)">Atr√°s</button><button class="btn" onclick="nextStep(4)">Siguiente</button></div>
      </div>
      <div id="step-4" class="wizard-step modal-body">
          <h2>Tu Estilo de Vida</h2>
          <p>Nivel de Actividad F√≠sica:</p>
          <select id="wiz-activity" style="width:100%; margin-bottom: 12px;">
              <option value="1.2">Sedentario (poco o nada)</option>
              <option value="1.375">Ligero (1-3 d√≠as/semana)</option>
              <option value="1.55">Moderado (3-5 d√≠as/semana)</option>
              <option value="1.725">Activo (6-7 d√≠as/semana)</option>
              <option value="1.9">Muy activo (trabajo f√≠sico + ejercicio)</option>
          </select>
          <p>Preferencia de Dieta (Opcional):</p>
          <select id="wiz-diet" style="width:100%">
              <option value="">Ninguna en especial</option><option value="balanced">Balanceada</option>
              <option value="keto">Cetog√©nica</option><option value="vegan">Vegana</option>
          </select>
          <div class="wizard-nav"><button class="btn secondary" onclick="prevStep(3)">Atr√°s</button><button class="btn" onclick="completeWizard()">Finalizar</button></div>
      </div>
    </div>
  </div>

  <div id="details-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header"><h2 id="modal-title-dynamic"></h2><button id="closeModal" class="modal-close">&times;</button></div>
      <div id="modal-body-dynamic" class="modal-body"></div>
      <div id="modal-footer-dynamic" class="modal-footer"></div>
    </div>
  </div>

  <div id="tutorial-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header"><h2 style="color:var(--accent-2)">üëã ¬°Empecemos con FitLifes¬°GO!</h2><button class="modal-close" onclick="closeTutorial()">&times;</button></div>
      <div class="modal-body">
          <p>La aplicaci√≥n est√° dise√±ada para ser f√°cil de usar, como una app m√≥vil:</p>
          <ul>
              <li><strong>Pesta√±as Inferiores (M√≥vil):</strong> Cambia de secci√≥n instant√°neamente con los botones de abajo.</li>
              <li><strong>Inicio:</strong> Ve tu resumen y ajusta tus m√©tricas de peso, altura, etc.</li>
              <li><strong>Diario:</strong> Guarda tu peso diario y marca tus tareas de agua/ejercicio. ¬°Todo se guarda autom√°ticamente en el navegador!</li>
              <li><strong>Planes/Dietas:</strong> Explora y selecciona tu rutina y estilo de comida.</li>
              <li><strong>Asistente:</strong> Preg√∫ntale cualquier duda de fitness, nutrici√≥n o salud.</li>
          </ul>
          <p>¬°Tu nombre y todo tu progreso se guardar√° incluso si cierras y abres el navegador! **¬°A darle!**</p>
      </div>
      <div class="modal-footer"><button class="btn" onclick="closeTutorial()">¬°Entendido!</button></div>
    </div>
  </div>


<script>
  // ====================
  // Base de datos (Mock)
  // ====================
  const DATABASE = {
      plans: {
          'weight_loss': { title: 'Plan: P√©rdida de peso', details: `<h3>Rutina Semanal (Ejemplo)</h3><ul><li><strong>Lunes:</strong> HIIT Total (30 min)</li><li><strong>Mi√©rcoles:</strong> Foco Abdomen y Piernas (40 min)</li><li><strong>Viernes:</strong> HIIT Cardio Intenso (35 min)</li><li><strong>S√°bado:</strong> Full Body Strength (45 min)</li></ul>`},
          'muscle_gain': { title: 'Plan: Aumento muscular', details: `<h3>Rutina Semanal (Ejemplo)</h3><ul><li><strong>Lunes:</strong> Pecho y Tr√≠ceps</li><li><strong>Martes:</strong> Espalda y B√≠ceps</li><li><strong>Mi√©rcoles:</strong> Piernas</li><li><strong>Viernes:</strong> Hombros y Trapecio</li><li><strong>S√°bado:</strong> Full Body</li></ul>`},
          'toning': { title: 'Plan: Tonificaci√≥n', details: `<h3>Rutina Semanal (Ejemplo)</h3><ul><li><strong>D√≠a 1:</strong> Full Body A + 15 min Cardio</li><li><strong>D√≠a 3:</strong> Full Body B + 15 min HIIT</li><li><strong>D√≠a 5:</strong> Full Body C + 20 min Cardio</li></ul>`}
      },
      diets: {
          'balanced': { title: 'Dieta Balanceada', macros: 'P 30% ‚Ä¢ C 45% ‚Ä¢ G 25%', details: `<h3>Ejemplo de Men√∫ (1 D√≠a)</h3><ul><li><strong>Desayuno:</strong> Avena con frutas y prote√≠na.</li><li><strong>Comida:</strong> Pollo a la plancha con quinoa y ensalada.</li><li><strong>Cena:</strong> Salm√≥n al horno con batata y br√≥coli.</li></ul>`},
          'keto': { title: 'Dieta Cetog√©nica', macros: 'P 20% ‚Ä¢ C 10% ‚Ä¢ G 70%', details: `<h3>Ejemplo de Men√∫ (1 D√≠a)</h3><ul><li><strong>Desayuno:</strong> Huevos revueltos con aguacate.</li><li><strong>Comida:</strong> Ensalada de ternera, aceite de oliva y nueces.</li><li><strong>Cena:</strong> Muslos de pollo al curry con coliflor.</li></ul>`},
          'vegan': { title: 'Dieta Vegana', macros: 'P 25% ‚Ä¢ C 55% ‚Ä¢ G 20%', details: `<h3>Ejemplo de Men√∫ (1 D√≠a)</h3><ul><li><strong>Desayuno:</strong> Tofu revuelto con pan integral.</li><li><strong>Comida:</strong> Bol de garbanzos, lentejas y arroz.</li><li><strong>Cena:</strong> Curry de lentejas rojas y espinacas.</li></ul>`}
      }
  };

  // Variables globales
  let wizardData = { goal: 'maintain' };
  
  // ==================== AOS init ====================
  AOS.init({once:true, duration:700});

  // ====================
  // L√≥gica de Tabs y Navegaci√≥n (Desktop y M√≥vil)
  // ====================
  function switchSection(targetId) {
      // 1. Ocultar todas las secciones y desactivar todos los enlaces/items
      document.querySelectorAll('.app-section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.querySelectorAll('.nav-desktop').forEach(n => n.classList.remove('active'));

      // 2. Mostrar la secci√≥n objetivo
      const targetSection = document.getElementById(targetId);
      if (targetSection) {
          targetSection.classList.add('active');
          // Para desktop, asegurarse de que solo se muestre el target o si es inicio
          if (window.innerWidth >= 900) {
              document.querySelectorAll('.app-section:not(#inicio)').forEach(s => s.style.display = 'none');
              targetSection.style.display = 'block';
              if (targetId !== 'inicio') {
                 // Si no es inicio, ocultar el hero y solo mostrar el target
                 document.querySelector('.hero').style.display = 'none';
                 // Ocultar la calculadora de inicio si no es la vista principal
                 document.getElementById('calculadora-inicio').style.display = 'none';
              } else {
                 document.querySelector('.hero').style.display = 'grid';
                 document.getElementById('calculadora-inicio').style.display = 'block';
              }
          }
      }
      
      // 3. Activar el √≠tem de navegaci√≥n correspondiente
      document.querySelectorAll(`[data-target="${targetId}"]`).forEach(n => n.classList.add('active'));
      
      // Scroll to top on mobile tab switch
      if (window.innerWidth < 900) {
          window.scrollTo({ top: 0, behavior: 'smooth' });
      }
  }

  // Asignar listeners a la barra inferior (M√≥vil)
  document.querySelectorAll('#bottom-nav .nav-item').forEach(item => {
      item.addEventListener('click', () => switchSection(item.getAttribute('data-target')));
  });
  
  // Asignar listeners a la barra superior (Desktop)
  document.querySelectorAll('.desktop-nav .nav-desktop').forEach(link => {
      link.addEventListener('click', (e) => {
          e.preventDefault();
          switchSection(link.getAttribute('data-target'));
      });
  });
  
  // ====================
  // L√≥gica de G√©nero Personalizado
  // ====================
  function checkCustomGender(selectId) {
      const select = document.getElementById(selectId);
      let inputId = '';
      if (selectId === 'sex') {
          inputId = 'custom-gender-input-metrics';
      } else if (selectId === 'wiz-sex') {
          inputId = 'custom-gender-input-wiz';
      }
      const customInput = document.getElementById(inputId);
      
      if (select.value === 'other') {
          customInput.style.display = 'block';
          customInput.required = true;
      } else {
          customInput.style.display = 'none';
          customInput.required = false;
      }
  }

  // ====================
  // L√≥gica del Cuestionario (Wizard)
  // ====================
  const wizardModal = document.getElementById('wizard-modal');
  
  function showWizard() {
      wizardModal.classList.add('visible');
      goToStep(1);
  }
  function closeWizard() {
      wizardModal.classList.remove('visible');
  }
  function goToStep(stepNum) {
      document.querySelectorAll('#wizard-modal .wizard-step').forEach(s => s.classList.remove('active'));
      document.getElementById('step-' + stepNum).classList.add('active');
  }
  function nextStep(stepNum) { goToStep(stepNum); }
  function prevStep(stepNum) { goToStep(stepNum); }

  function selectWizardOption(key, value) {
      wizardData[key] = value;
      const group = key === 'goal' ? 'goal' : '';
      if(group) {
          document.querySelectorAll(`.wizard-options .option[id^="${group}-"]`).forEach(o => o.classList.remove('selected'));
          document.getElementById(`${group}-${value}`).classList.add('selected');
      }
  }

  function completeWizard() {
      const name = document.getElementById('wiz-name').value;
      const age = document.getElementById('wiz-age').value;
      const height = document.getElementById('wiz-height').value;
      const weight = document.getElementById('wiz-weight').value;
      const sex = document.getElementById('wiz-sex').value;
      const customGender = document.getElementById('custom-gender-input-wiz').value;
      const activity = document.getElementById('wiz-activity').value;
      const dietId = document.getElementById('wiz-diet').value;

      if (!name || !age || !height || !weight) {
          return alert('Por favor, completa tu nombre, edad, altura y peso.');
      }
      if (sex === 'other' && !customGender) {
          return alert('Por favor, especifica el g√©nero con el que te identificas o elige otra opci√≥n.');
      }

      localStorage.setItem('fitlife_user', JSON.stringify({ name }));
      const profile = { age, height, weight, sex, customGender, activity, goal: wizardData.goal };
      localStorage.setItem('fitlife_profile', JSON.stringify(profile));
      
      if(dietId) {
          const dietName = DATABASE.diets[dietId]?.title || 'Balanceada';
          selectDiet(dietName, dietId, true); 
      }

      closeWizard();
      alert(`¬°Bienvenido, ${name}! Tu perfil de FitLifes¬°GO! est√° configurado.`);
      localStorage.setItem('fitlife_first_load', 'false'); // Marcar como cargado
      loadProfile();
      welcomeAssistant();
      showTutorial(); // Mostrar tutorial al terminar el wizard
  }

  // ====================
  // L√≥gica de Tutorial
  // ====================
  const tutorialModal = document.getElementById('tutorial-modal');

  function showTutorial() {
      tutorialModal.classList.add('visible');
  }
  function closeTutorial() {
      tutorialModal.classList.remove('visible');
  }

  // ====================
  // L√≥gica de Perfil y Carga
  // ====================
  function saveProfile(){
    const age = document.getElementById('age').value;
    const height = document.getElementById('height').value;
    const weight = document.getElementById('weight').value;
    const sex = document.getElementById('sex').value;
    const customGender = document.getElementById('custom-gender-input-metrics').value;
    if(!age || !height || !weight){ return alert('Por favor, completa edad, altura y peso para guardar.'); }
    
    const p = JSON.parse(localStorage.getItem('fitlife_profile') || '{}');
    p.age = age;
    p.height = height;
    p.weight = weight;
    p.sex = sex;
    p.customGender = customGender;
    
    localStorage.setItem('fitlife_profile', JSON.stringify(p));
    alert('M√©tricas guardadas');
    loadProfile();
  }
  document.getElementById('saveProfile').addEventListener('click', saveProfile);
  document.getElementById('clearData').addEventListener('click', ()=>{
      if(confirm('¬øEst√°s seguro de que quieres borrar todos tus datos guardados (perfil, progreso, diario)?')){
          localStorage.clear();
          location.reload();
      }
  });

  function loadProfile() {
      const p = JSON.parse(localStorage.getItem('fitlife_profile') || 'null');
      if(p){ 
          document.getElementById('age').value = p.age; 
          document.getElementById('height').value = p.height; 
          document.getElementById('weight').value = p.weight; 
          document.getElementById('sex').value = p.sex; 
          
          document.getElementById('selectedGoal').textContent = p.goal ? (p.goal.charAt(0).toUpperCase() + p.goal.slice(1)) : 'No definido';
          
          // L√≥gica de carga de g√©nero personalizado
          document.getElementById('custom-gender-input-metrics').value = p.customGender || '';
          checkCustomGender('sex'); // Asegura que el campo opcional se muestre/oculte correctamente.

          calculateIMC(); 
          calculateCalories(p.activity, p.goal);
      }

      const d = JSON.parse(localStorage.getItem('fitlife_selected_diet') || 'null'); 
      if(d) document.getElementById('selectedDiet').textContent = d.name;
      else document.getElementById('selectedDiet').textContent = 'Ninguna';

      const p_plan = JSON.parse(localStorage.getItem('fitlife_selected_plan') || 'null');
      if(p_plan) document.getElementById('selectedPlan').textContent = p_plan.name;
      else document.getElementById('selectedPlan').textContent = 'Ninguno';
  }

  // ====================
  // L√≥gica de C√°lculos (IMC, TMB)
  // ====================
  function calculateIMC(){
    const w = parseFloat(document.getElementById('weight').value);
    const h = parseFloat(document.getElementById('height').value)/100;
    const el = document.getElementById('imcValue');
    if(!w || !h){ el.textContent = '‚Äî'; return }
    const imc = (w/(h*h)).toFixed(1);
    el.textContent = imc;
  }
  document.getElementById('weight').addEventListener('input', calculateIMC);
  document.getElementById('height').addEventListener('input', calculateIMC);

  function calculateCalories(activity_val = null, goal_val = null){
    const age = Number(document.getElementById('age').value);
    const height = Number(document.getElementById('height').value);
    const weight = Number(document.getElementById('weight').value);
    const sex = document.getElementById('sex').value;
    
    const p = JSON.parse(localStorage.getItem('fitlife_profile') || 'null');
    const activity = activity_val || (p ? p.activity : 1.375);
    const goal = goal_val || (p ? p.goal : 'maintain');
    
    if(!age||!height||!weight|| sex === 'other'){
        document.getElementById('tmb').textContent = '‚Äî';
        document.getElementById('targetCalories').textContent = '‚Äî';
        if (sex === 'other') document.getElementById('tmb').textContent = 'Calculadora TMB solo para Hombre/Mujer';
        return;
    }
    let tmb = 0;
    // F√≥rmula de Harris-Benedict (revisada)
    if(sex==='male') tmb = 10*weight + 6.25*height - 5*age + 5;
    else tmb = 10*weight + 6.25*height - 5*age - 161;
    
    const maintenance = Math.round(tmb * activity);
    let target = maintenance;
    if(goal==='lose') target = Math.round(maintenance - 500);
    if(goal==='gain') target = Math.round(maintenance + 400);
    document.getElementById('tmb').textContent = Math.round(tmb) + ' kcal';
    document.getElementById('targetCalories').textContent = target + ' kcal';
  }

  // ====================
  // Gr√°ficos (Charts)
  // ====================
  function makeDoughnut(ctxId, data, labels, colors){
    const ctx = document.getElementById(ctxId).getContext('2d');
    return new Chart(ctx, {
      type:'doughnut',
      data:{labels:labels,datasets:[{data:data,backgroundColor:colors,borderWidth:2,borderColor:'rgba(0,0,0,0.15)'}]},
      options:{ responsive:true,maintainAspectRatio:false,cutout:'60%', plugins:{legend:{display:false},tooltip:{callbacks:{label:function(ctx){return ctx.label+': '+ctx.parsed + '%'}}}}}
    });
  }
  let chartBalanced = makeDoughnut('chart-balanced',[30,45,25],['Prote√≠nas','Carbohidratos','Grasas'],['#3b82f6','#fb923c','#10b981']);
  let chartKeto = makeDoughnut('chart-keto',[20,10,70],['Prote√≠nas','Carbohidratos','Grasas'],['#3b82f6','#fb923c','#10b981']);
  let chartVegan = makeDoughnut('chart-vegan',[25,55,20],['Prote√≠nas','Carbohidratos','Grasas'],['#3b82f6','#fb923c','#10b981']);

  const ctxP = document.getElementById('progressChart').getContext('2d');
  const savedProgress = JSON.parse(localStorage.getItem('fitlife_progress') || '[]');
  const progressChart = new Chart(ctxP, {type:'line',data:{labels:savedProgress.map(p=>p.date),datasets:[{label:'Peso (kg)',data:savedProgress.map(p=>p.weight),fill:false,tension:0.3, borderColor: 'var(--accent)'}]},options:{responsive:true,plugins:{legend:{display:false}}}});
  
  // ====================
  // L√≥gica del Diario
  // ====================
  const journalLogEl = document.getElementById('journal-log');
  
  function loadJournal() {
      // Logic for journal and progress chart loading (same as before)
      const journal = JSON.parse(localStorage.getItem('fitlife_journal') || '[]');
      if (journal.length === 0) {
          journalLogEl.innerHTML = '<p>A√∫n no hay entradas.</p>';
      } else {
          journalLogEl.innerHTML = '';
          journal.reverse().slice(0, 10).forEach(entry => { // Mostrar solo las √∫ltimas 10 entradas
              const entryEl = document.createElement('div');
              entryEl.className = 'log-entry';
              let summary = `<ul>`;
              if (entry.workout) summary += `<li>‚úÖ Entrenaste.</li>`;
              if (entry.diet) summary += `<li>‚úÖ Seguiste tu dieta.</li>`;
              if (entry.water) summary += `<li>‚úÖ Bebiste 2L de agua.</li>`;
              if (entry.calories) summary += `<li>Consumiste aprox. <strong>${entry.calories} kcal</strong>.</li>`;
              if (!entry.workout && !entry.diet && !entry.water && !entry.calories) {
                  summary += `<li>No se registraron actividades este d√≠a.</li>`;
              }
              summary += `</ul>`;
              entryEl.innerHTML = `<div class="log-entry-date">${entry.date}</div>${summary}`;
              journalLogEl.appendChild(entryEl);
          });
      }
      
      const prog = JSON.parse(localStorage.getItem('fitlife_progress') || '[]');
      progressChart.data.labels = prog.map(p=>p.date); 
      progressChart.data.datasets[0].data = prog.map(p=>p.weight); 
      progressChart.update(); 
  }

  function completeDay() {
      const water = document.getElementById('track-water').checked;
      const workout = document.getElementById('track-workout').checked;
      const diet = document.getElementById('track-diet').checked;
      const calories = document.getElementById('track-calories').value;
      const weight = document.getElementById('pesoInput').value;
      
      const journal = JSON.parse(localStorage.getItem('fitlife_journal') || '[]');
      const today = new Date().toLocaleDateString();

      // Guardar entrada de diario
      const existingIndex = journal.findIndex(entry => entry.date === today);
      const newEntry = { date: today, water, workout, diet, calories };

      if (existingIndex > -1) {
          journal[existingIndex] = newEntry;
      } else {
          journal.push(newEntry);
      }
      localStorage.setItem('fitlife_journal', JSON.stringify(journal));

      // Guardar peso si se introduce
      if(weight) {
          const arr = JSON.parse(localStorage.getItem('fitlife_progress') || '[]');
          const now = new Date(); const label = now.toLocaleDateString();
          arr.push({date:label,weight:Number(weight)});
          localStorage.setItem('fitlife_progress', JSON.stringify(arr));
          document.getElementById('weight').value = weight;
          saveProfile(); // Actualiza perfil y c√°lculos
      }
      
      alert('¬°D√≠a completado! Tu progreso ha sido guardado en el diario.');
      
      loadJournal(); // Recargar el diario y el gr√°fico
      
      // Limpiar el tracker
      document.getElementById('track-water').checked = false;
      document.getElementById('track-workout').checked = false;
      document.getElementById('track-diet').checked = false;
      document.getElementById('track-calories').value = '';
      document.getElementById('pesoInput').value = '';
  }
  
  // ====================
  // Modal de Detalles y Selecci√≥n
  // ====================
  const detailsModal = document.getElementById('details-modal');
  const modalTitle = document.getElementById('modal-title-dynamic');
  const modalBody = document.getElementById('modal-body-dynamic');
  const modalFooter = document.getElementById('modal-footer-dynamic');

  function closeDetailsModal() { detailsModal.classList.remove('visible'); }
  document.getElementById('closeModal').onclick = closeDetailsModal;
  detailsModal.onclick = (e) => { if(e.target === detailsModal) closeDetailsModal(); }; 

  function showPlanDetails(planId) {
      const plan = DATABASE.plans[planId]; if (!plan) return;
      modalTitle.textContent = plan.title;
      modalBody.innerHTML = plan.details;
      modalFooter.innerHTML = `<button class="btn" onclick="selectPlan('${planId}', '${plan.title}')">Seleccionar este Plan</button>`;
      detailsModal.classList.add('visible');
  }

  function showDietDetails(dietId) {
      const diet = DATABASE.diets[dietId]; if (!diet) return;
      modalTitle.textContent = diet.title;
      modalBody.innerHTML = `<p><span class="badge">Macros: ${diet.macros}</span></p><hr style="border-color:var(--glass); margin: 15px 0;">${diet.details}`;
      modalFooter.innerHTML = `<button class="btn" onclick="selectDiet('${diet.title}', '${dietId}'); closeDetailsModal();">Seleccionar esta Dieta</button>`;
      detailsModal.classList.add('visible');
  }

  function selectDiet(name, dietId, silent = false){
    document.getElementById('selectedDiet').textContent = name;
    localStorage.setItem('fitlife_selected_diet', JSON.stringify({id: dietId, name: name}));
    if(!silent) alert('Dieta "'+name+'" seleccionada y guardada.');
  }

  function selectPlan(planId, name){
    document.getElementById('selectedPlan').textContent = name;
    localStorage.setItem('fitlife_selected_plan', JSON.stringify({id: planId, name: name}));
    alert('Plan "'+name+'" seleccionado y guardado.');
    closeDetailsModal();
  }

  // ====================
  // Asistente de Chat (MEJORADO)
  // ====================
  const messagesEl = document.getElementById('messages');
  function appendMessage(text, who='bot'){
    const d = document.createElement('div'); d.className='msg '+(who==='user'?'user':'bot'); d.textContent=text; messagesEl.appendChild(d); messagesEl.scrollTop = messagesEl.scrollHeight;
  }
  function sendMessage(){
    const input = document.getElementById('chatInput'); const text = input.value.trim(); if(!text) return;
    appendMessage(text,'user'); input.value='';
    
    setTimeout(()=>{
      const t = text.toLowerCase();
      const p = JSON.parse(localStorage.getItem('fitlife_profile') || 'null');
      const goal = p ? p.goal : 'maintain';
      const weight = p ? p.weight : null;

      let response = 'Lo siento, no entend√≠ eso. Preg√∫ntame sobre dietas, ejercicios b√°sicos o consejos de motivaci√≥n.';
      
      if(t.includes('saludar') || t.includes('hola') || t.includes('qu√© tal')) {
          response = '¬°Hola! Soy tu Asistente FitLifes¬°GO!. Estoy aqu√≠ para ayudarte con tus dudas de fitness, nutrici√≥n y progreso. ¬øC√≥mo te sientes hoy?';
      }
      else if(t.includes('dieta') || t.includes('comer') || t.includes('nutrici√≥n')) {
          if (goal === 'lose') response = 'Para perder peso, enf√≥cate en un d√©ficit cal√≥rico de unas 500 kcal diarias y prioriza la prote√≠na y fibra. ¬°No te saltes los carbohidratos saludables!';
          else if (goal === 'gain') response = 'Para ganar m√∫sculo, necesitas un super√°vit cal√≥rico y al menos 1.6g de prote√≠na por kg de peso corporal. ¬°Aseg√∫rate de comer suficientes carbohidratos para energ√≠a!';
          else response = 'Una dieta balanceada es clave. Aseg√∫rate de incluir todos los grupos de alimentos y no exceder tus calor√≠as de mantenimiento.';
      }
      else if(t.includes('ejercicio') || t.includes('rutina') || t.includes('entrenar')) {
          if (goal === 'lose') response = 'Combina el entrenamiento de fuerza (para mantener m√∫sculo) con 3-4 sesiones de cardio por semana (HIIT o de baja intensidad).';
          else if (goal === 'gain') response = 'Conc√©ntrate en ejercicios compuestos (sentadilla, peso muerto, press). 4-5 veces por semana con buena intensidad y descanso de 2 minutos entre series.';
          else response = 'Busca un equilibrio. 3 d√≠as de fuerza y 2 de cardio ligero te ayudar√°n a mantener tu figura y salud cardiovascular.';
      }
      else if(t.includes('agua') || t.includes('hidrataci√≥n')) {
          response = 'La hidrataci√≥n es vital. Intenta beber al menos 2-3 litros de agua al d√≠a, especialmente si entrenas. ¬°Recuerda marcarlo en el Diario!';
      }
      else if(t.includes('descanso') || t.includes('dormir')) {
          response = 'El descanso es donde ocurre la magia. Intenta dormir 7-9 horas. La falta de sue√±o afecta negativamente la quema de grasa y la recuperaci√≥n muscular.';
      }
      else if(t.includes('objetivo') || t.includes('mi meta')) {
          const goalName = goal === 'lose' ? 'Perder Peso' : (goal === 'gain' ? 'Ganar M√∫sculo' : 'Mantener Peso');
          response = `Tu objetivo actual est√° configurado como: **${goalName}**. ¬°Sigue as√≠!`;
      }
      else if(t.includes('calor') || t.includes('tmb')) {
          response = 'La TMB (Tasa Metab√≥lica Basal) es lo que tu cuerpo quema en reposo. Puedes ver tus c√°lculos en la pesta√±a "Inicio", secci√≥n "Mis M√©tricas".';
      }
      else if(t.includes('motivaci√≥n') || t.includes('√°nimo')) {
          const quotes = ['"La disciplina es el puente entre tus metas y tus logros."', '"Hoy es el d√≠a de empezar de nuevo, no de rendirse."','Recuerda por qu√© empezaste. ¬°Cada paso cuenta!'];
          response = quotes[Math.floor(Math.random() * quotes.length)];
      }
      else if(t.includes('peso actual') && weight) {
          response = `Tu √∫ltimo peso registrado es de ${weight} kg. ¬°Sigue actualizando tu progreso en la pesta√±a Diario!`;
      }
      
      appendMessage(response,'bot');
    },600);
  }
  document.getElementById('chatInput').addEventListener('keydown', (e)=>{ if(e.key==='Enter') sendMessage(); });

  function welcomeAssistant() {
      messagesEl.innerHTML = '';
      const u = JSON.parse(localStorage.getItem('fitlife_user') || 'null');
      const p = JSON.parse(localStorage.getItem('fitlife_profile') || 'null');
      let name = u ? u.name : 'Hola';
      let goal_msg = p ? ` Veo que tu objetivo es ${p.goal === 'lose' ? 'perder peso' : (p.goal === 'gain' ? 'ganar m√∫sculo' : 'mantenerte')}.` : '';
      
      appendMessage(`${name} üëã. Soy tu Asistente FitLifes¬°GO!${goal_msg} ¬øEn qu√© te ayudo hoy?`);
  }

  // ====================
  // L√≥gica de Carga Inicial y Controles
  // ====================
  const themeToggle = document.getElementById('themeToggle');

  window.addEventListener('load', ()=>{
    // 1. Cargar Tema
    const savedTheme = localStorage.getItem('fitlife_theme') || 'dark';
    document.body.setAttribute('data-theme', savedTheme);
    themeToggle.innerHTML = savedTheme === 'light' ? '<i class="fa-solid fa-sun"></i>' : '<i class="fa-solid fa-moon"></i>';

    // 2. Cargar Perfil y Decidir si mostrar Wizard/Tutorial
    const firstLoad = localStorage.getItem('fitlife_first_load') !== 'false';
    const p = JSON.parse(localStorage.getItem('fitlife_profile') || 'null');
    
    if(p) {
        loadProfile();
        if(firstLoad) showTutorial();
    } else {
        showWizard();
    }
    
    loadJournal();
    welcomeAssistant();

    // 3. Inicializar vista Desktop/Mobile (Mobile First por defecto)
    if (window.innerWidth >= 900) {
        switchSection('inicio');
    } else {
        // En m√≥vil, asegurarse de que solo se ve la primera secci√≥n
        document.querySelectorAll('.app-section').forEach(s => s.classList.remove('active'));
        document.getElementById('inicio').classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.querySelector('.nav-item[data-target="inicio"]').classList.add('active');
    }
  });

  // Control de Tema
  function toggleTheme() {
    const el = document.body;
    const cur = el.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
    el.setAttribute('data-theme', cur);
    localStorage.setItem('fitlife_theme', cur);
    themeToggle.innerHTML = cur === 'light' ? '<i class="fa-solid fa-sun"></i>' : '<i class="fa-solid fa-moon"></i>';
  }
  themeToggle.addEventListener('click', toggleTheme);

  // Control de Perfil/Wizard
  const openRegister = document.getElementById('openRegister');
  openRegister.addEventListener('click', ()=>{
      const p = JSON.parse(localStorage.getItem('fitlife_profile') || 'null');
      if (p) {
          // Carga los datos existentes en el wizard antes de mostrar
          document.getElementById('wiz-name').value = JSON.parse(localStorage.getItem('fitlife_user') || '{}').name || '';
          document.getElementById('wiz-sex').value = p.sex;
          document.getElementById('wiz-age').value = p.age;
          document.getElementById('wiz-height').value = p.height;
          document.getElementById('wiz-weight').value = p.weight;
          document.getElementById('wiz-activity').value = p.activity;
          document.getElementById('custom-gender-input-wiz').value = p.customGender || '';
          checkCustomGender('wiz-sex');
          selectWizardOption('goal', p.goal);
          const d = JSON.parse(localStorage.getItem('fitlife_selected_diet') || 'null');
          if (d) document.getElementById('wiz-diet').value = d.id;
      }
      showWizard();
  });

</script>
</body>
</html>
