<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>FitLifes¬°GO! ‚Äî Tu App de Fitness & Dieta</title>
  <meta name="description" content="Aplicaci√≥n de fitness con seguimiento diario, planes, dietas y asistente." />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a2d9b5f2d5.js" crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <style>
    /* ==========================
        Estilos principales
       ========================== */
    :root{
      --bg: #0f1724;
      --card: #0b1220;
      --muted: #9aa4b2;
      --accent: #2dd4bf;
      --accent-2: #f59e0b;
      --glass: rgba(255,255,255,0.03);
      --radius: 12px;
      --ff: 'Inter',system-ui,Arial;
    }
    [data-theme="light"]{
      --bg: #f6f8fa;
      --card: #ffffff;
      --muted: #4b5563;
      --accent: #059669;
      --accent-2: #ea580c;
      --glass: rgba(2,6,23,0.03);
    }

    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; font-family:var(--ff); background:var(--bg); color:var(--muted);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      transition:background .3s, color .3s;
    }

    header{display:flex;align-items:center;justify-content:space-between;padding:18px 28px;background:linear-gradient(180deg, rgba(0,0,0,0.06), transparent);backdrop-filter: blur(6px);position:sticky;top:0;z-index:40}
    .brand{display:flex;gap:12px;align-items:center;color:var(--accent)}
    .brand img { height: 30px; width: auto; }
    .brand h1{margin:0;font-size:1.1rem;color:inherit}

    .desktop-nav{display:flex;gap:10px;align-items:center}
    .desktop-nav a{color:var(--muted);text-decoration:none;padding:8px 12px;border-radius:8px; cursor:pointer;}
    .desktop-nav a:hover{background:var(--glass);color:inherit}
    .desktop-nav a.active { color: var(--accent); font-weight: 600; }

    .desktop-controls{display:flex;gap:10px;align-items:center}
    .btn{background:var(--accent);color:#042027;padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:600; text-decoration:none; display:inline-block; text-align:center;}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

    #mobile-menu-btn { display: none; }

    main{
        padding:28px;max-width:1200px;margin:18px auto;
        padding-bottom: 90px;
    }

    /* Estructura de Pesta√±as (Tabs) */
    .tab-page { display: none; }
    .tab-page.active { display: block; }
    
    /* Layout de Grid para la p√°gina de INICIO */
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 16px;
    }
    .main-col { grid-column: span 8; }
    .sidebar-col { grid-column: span 4; display:flex; flex-direction:column; gap:16px;}
    
    .content-stack {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    /* Hero */
    .hero{display:grid;grid-template-columns:1fr 420px;gap:18px;align-items:center;margin-bottom:16px}
    .hero .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:28px;border-radius:var(--radius)}
    .hero h2{margin:0 0 10px 0;color:var(--accent);font-size:1.8rem}
    .hero p{margin:0 0 18px 0;color:var(--muted)}
    .hero-buttons{display:flex;gap:10px;margin-top:12px}

    /* Cards */
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 22px rgba(2,6,23,0.25)}
    h3{margin-top:0;color:var(--muted)}

    .plans{display:flex;gap:12px;flex-wrap:wrap}
    .plan{flex:1 1 220px;padding:14px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);border:1px solid rgba(255,255,255,0.03)}
    
    .diet-list{display:flex;gap:12px;flex-wrap:wrap}
    .diet-card{display:flex;gap:12px;align-items:center;flex:1 1 300px;padding:12px;border-radius:12px}
    .diet-info{flex:1}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(0,0,0,0.06);font-weight:600}

    .chart-wrap{width:140px;height:140px;display:flex;align-items:center;justify-content:center}

    .form-row{display:flex;gap:8px;margin-bottom:10px}
    input,select{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit; width:100%;}
    .form-row input, .form-row select {flex: 1;}

    .chat{display:flex;flex-direction:column;height:320px}
    .chat .messages{flex:1;overflow:auto;padding:10px;display:flex;flex-direction:column;gap:8px}
    .msg{max-width:70%;padding:10px;border-radius:10px}
    .msg.user{align-self:flex-end;background:var(--accent);color:#002024}
    .msg.bot{align-self:flex-start;background:rgba(255,255,255,0.03)}
    .chat-input{display:flex;gap:8px;margin-top:8px}
    .chat-input input{flex:1}

    /* Modales */
    #wizard-modal .modal-content, #tutorial-modal .modal-content {
      max-height: 90vh;
      display: flex;
      flex-direction: column;
    }
    .wizard-step{display:none;}
    .wizard-step.active{display:block;}
    .wizard-nav{display:flex;justify-content:space-between;margin-top:20px;}
    .wizard-options .option{
      display:block; padding:12px 18px; border:1px solid var(--glass);
      border-radius:10px; margin-bottom:10px; cursor:pointer;
    }
    .wizard-options .option:hover{background:var(--glass);}
    .wizard-options .option.selected{border-color:var(--accent); color:var(--accent);}

    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex; align-items: center; justify-content: center;
      z-index: 100; backdrop-filter: blur(5px);
      opacity: 0; visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .modal-overlay.visible { opacity: 1; visibility: visible; }

    .modal-content {
      background: var(--card);
      border-radius: var(--radius);
      width: 90%; max-width: 600px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
      transform: translateY(-30px) scale(0.95);
      opacity: 0;
      transition: transform 0.3s ease-out, opacity 0.3s ease-out;
      display: flex; flex-direction: column;
      max-height: 90vh;
    }
    .modal-overlay.visible .modal-content { transform: translateY(0) scale(1); opacity: 1; }
    
    .modal-header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 18px 28px; border-bottom: 1px solid var(--glass);
    }
    .modal-header h2 { margin: 0; color: var(--accent); font-size: 1.4rem; }
    .modal-close {
      background: none; border: none; color: var(--muted); font-size: 2.2rem;
      cursor: pointer; line-height: 1; padding: 0;
    }
    .modal-body { padding: 20px 28px; overflow-y: auto; }
    .modal-body p { margin-bottom: 10px; }
    .modal-body ul { padding-left: 20px; margin-top: 0; }
    .modal-body li { margin-bottom: 8px; }
    .modal-body h3 { color: var(--accent-2); }
    .modal-body .badge {
        display: inline-block; padding: 6px 12px; border-radius: 999px;
        background: var(--glass); font-weight: 600; font-size: 0.9rem;
    }
    .modal-footer {
      padding: 18px 28px; border-top: 1px solid var(--glass);
      display: flex; justify-content: flex-end;
    }
    .modal-content .form-row { margin-bottom: 5px; } /* Ajuste de espacio en modales */

    /* Men√∫ M√≥vil (Hamburguesa) */
    #mobile-menu-overlay { justify-content: flex-end; z-index: 110; }
    .mobile-menu-content {
        background: var(--card); width: 80%; max-width: 320px; height: 100%;
        border-left: 1px solid var(--glass); box-shadow: -10px 0 30px rgba(0,0,0,0.3);
        display: flex; flex-direction: column; padding: 20px;
        transform: translateX(100%);
        transition: transform 0.3s ease-out;
    }
    .modal-overlay.visible .mobile-menu-content { transform: translateX(0); }
    #mobile-menu-overlay .modal-close { align-self: flex-end; margin-bottom: 15px; }
    .mobile-menu-content h2 { color: var(--accent); margin-top: 0; margin-bottom: 20px; }
    .mobile-menu-content button {
        display: block; width: 100%; text-align: left; padding: 14px; margin-bottom: 10px;
        text-decoration: none; color: var(--muted); background: var(--glass);
        border-radius: 10px; font-size: 1rem; font-weight: 600;
        border: none; cursor: pointer;
    }
    .mobile-menu-content button:hover { background: rgba(255,255,255, 0.06); }
    .mobile-menu-content hr { border-color: var(--glass); margin: 10px 0 20px 0; }

    /* Panel "Mi D√≠a" */
    .tracker-item{display:flex;align-items:center;gap:10px;margin-bottom:12px;}
    .tracker-item input[type="checkbox"]{width:20px;height:20px; flex-shrink:0;}
    .tracker-item label{flex:1;}

    /* Secci√≥n "Diario" */
    .journal-log{
        max-height: 400px; overflow-y: auto; padding-right: 10px;
        display:flex; flex-direction: column; gap: 12px;
    }
    .log-entry{
        background: var(--glass); padding: 14px; border-radius: 10px;
        border-left: 4px solid var(--accent);
    }
    .log-entry-date{font-weight:700; color:var(--accent-2);}
    .log-entry ul{padding-left:20px; margin-bottom:0;}

    /* Footer */
    footer{
        padding:28px; text-align:center; color:var(--muted);
        margin-top: 30px; border-top: 1px solid var(--glass);
    }
    footer p { margin: 5px 0; }
    footer strong { color: var(--accent); }

    /* Tarjeta de Perfil */
    #profile-header-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
    }
    .profile-image {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid var(--accent);
        cursor: pointer;
        background-color: var(--glass);
    }
    #profile-header-card h2 {
        margin: 0;
        color: white;
    }
    #profile-header-card p {
        margin: -10px 0 0 0;
        font-size: 0.9rem;
        color: var(--muted);
        text-align: center;
    }
    #profile-header-card p strong {
        color: var(--accent-2);
    }

    /* Barra de Pesta√±as (Tab Bar) */
    .mobile-tab-bar {
        display: none; /* Oculto en desktop */
        position: fixed;
        bottom: 0; left: 0; right: 0;
        height: 70px;
        background: var(--card);
        border-top: 1px solid var(--glass);
        box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
        z-index: 39;
        padding: 0 5px;
    }
    .tab-bar-nav {
        display: flex;
        justify-content: space-around;
        align-items: center;
        width: 100%;
        height: 100%;
    }
    .tab-btn {
        background: none; border: none;
        color: var(--muted);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-size: 0.65rem; /* Reducido para 5 pesta√±as */
        cursor: pointer;
        padding: 8px 5px;
        border-radius: 8px;
        transition: color 0.2s ease, background 0.2s ease;
        flex: 1;
    }
    .tab-btn i { font-size: 1.3rem; margin-bottom: 4px; }
    .tab-btn.active { color: var(--accent); }
    .tab-btn:hover { background: var(--glass); }

    /* Responsive */
    @media (max-width:900px){
      header { padding: 15px; }
      main { padding: 15px; padding-bottom: 90px; }
      
      .desktop-nav, .desktop-controls { display: none; }
      #mobile-menu-btn { display: block; }
      .mobile-tab-bar { display: block; }

      .dashboard-grid { display: block; }
      .main-col, .sidebar-col { grid-column: auto; }
      .card[data-aos] { margin-top: 16px; }
      
      .hero, #tracker-desktop-card { display: none; }
      #tracker-mobile-card { display: block; }

      .diet-list { flex-direction: column; }
      .diet-card { flex-direction: column; text-align: center; }
      .chart-wrap { margin-bottom: 10px; }
      
      .form-row { flex-direction: column; }
    }
    @media (min-width: 901px) {
        #tracker-mobile-card { display: none; }
    }
  </style>
</head>
<body data-theme="dark">
  <header>
    <div class="brand">
        <img src="logos/FitLifesGoLOGO.png" alt="FitLifes¬°GO! Logo">
        <h1>FitLifes¬°GO!</h1>
    </div>
    
    <nav class="desktop-nav">
      <a onclick="showPage('page-inicio', this)" class="active">Inicio</a>
      <a onclick="showPage('page-diario', this)">Diario</a>
      <a onclick="showPage('page-planes', this)">Planes</a>
      <a onclick="showPage('page-comunidad', this)">Comunidad</a>
      <a onclick="showPage('page-perfil', this)">Perfil</a>
      <a onclick="showPage('page-info', this)">Info</a>
    </nav>
    <div class="desktop-controls">
      <button id="themeToggle" class="btn secondary" title="Cambiar tema"><i class="fa-solid fa-moon"></i></button>
      <button id="openRegister" class="btn">Mi Perfil</button>
    </div>

    <button id="mobile-menu-btn" class="btn secondary"><i class="fa-solid fa-bars"></i></button>

  </header>

  <main>
    <div id="page-inicio" class="tab-page active">
        <div class="dashboard-grid">
            <div class="main-col">
                <section class="hero" id="inicio">
                    <div class="card">
                      <h2>Entrena con prop√≥sito, come con intenci√≥n</h2>
                      <p>Planes personalizados, calculadoras, seguimiento y un sistema visual de dietas con gr√°ficos para entender tus macros de forma r√°pida.</p>
                      <div class="hero-buttons">
                        <button class="btn" onclick="showPage('page-planes')">Ver Planes</button>
                        <button class="btn secondary" onclick="showPage('page-diario')">Mi Diario</button>
                      </div>
                    </div>
              
                    <div class="card">
                      <h3>Panel r√°pido</h3>
                      <p class="badge">IMC: <span id="imcValue">‚Äî</span></p>
                      <p style="margin-top:8px">Objetivo: <strong id="selectedGoal">...</strong></p>
                      <p style="margin-top:8px">Dieta seleccionada: <strong id="selectedDiet">...</strong></p>
                      <p style="margin-top:8px">Plan seleccionado: <strong id="selectedPlan">...</strong></p>
                    </div>
                </section>
                
                <div class="card" id="tracker-mobile-card" data-aos="fade-up">
                    <div id="tracker" class="content-stack">
                        <h3>Seguimiento de Hoy</h3>
                        <div class="tracker-item"> <input type="checkbox" id="track-water"> <label for="track-water">Beb√≠ 2L de agua</label> </div>
                        <div class="tracker-item"> <input type="checkbox" id="track-workout"> <label for="track-workout">Entren√© hoy</label> </div>
                        <div class="tracker-item"> <input type="checkbox" id="track-diet"> <label for="track-diet">Segu√≠ mi dieta</label> </div>
                        <hr style="border-color:var(--glass); margin: 8px 0;">
                        <div class="tracker-item"> <input type="checkbox" id="track-sleep"> <label for="track-sleep">Dorm√≠ al menos 7 horas</label> </div>
                        <div class="tracker-item"> <input type="checkbox" id="track-fruit"> <label for="track-fruit">Com√≠ 5 porciones de verdura/fruta</label> </div>
                        <div class="tracker-item"> <input type="checkbox" id="track-stretch"> <label for="track-stretch">Hice estiramientos / movilidad</label> </div>
                        <div class="tracker-item"> <input type="checkbox" id="track-meditate"> <label for="track-meditate">Medit√© 10 minutos</label> </div>
                        <div class="tracker-item"> <input type="checkbox" id="track-supplement"> <label for="track-supplement">Tom√© mi suplemento (ej. prote√≠na)</label> </div>
                        <hr style="border-color:var(--glass); margin: 8px 0;">
                        <div id="tracker-custom-mobile"></div>

                        <hr style="border-color:var(--glass); margin: 12px 0;">
                        <div class="form-row"> <input type="number" id="track-calories" placeholder="Calor√≠as consumidas (ej: 1800)"> </div>
                        <button class="btn" style="width:100%" onclick="completeDay()">Completar D√≠a</button>
                    </div>
                </div>

                <div class="card" data-aos="fade-up">
                    <h3>Asistente FitLifes¬°GO!</h3>
                    <div class="chat">
                      <div class="messages" id="messages"></div>
                      <div class="chat-input">
                        <input id="chatInput" placeholder="Preg√∫ntame algo..." />
                        <button class="btn" onclick="sendMessage()">Enviar</button>
                      </div>
                    </div>
                </div>

            </div>
            
            <div class="sidebar-col">
                <div id="tracker-desktop-card" class="card" data-aos="fade-left">
                    <div id="tracker" class="content-stack">
                        <h3>Seguimiento de Hoy</h3>
                        <div class="tracker-item"> <input type="checkbox" id="track-water-desktop"> <label for="track-water-desktop">Beb√≠ 2L de agua</label> </div>
                        <div class="tracker-item"> <input type="checkbox" id="track-workout-desktop"> <label for="track-workout-desktop">Entren√© hoy</label> </div>
                        <div class="tracker-item"> <input type="checkbox" id="track-diet-desktop"> <label for="track-diet-desktop">Segu√≠ mi dieta</label> </div>
                        <hr style="border-color:var(--glass); margin: 8px 0;">
                        <div class="tracker-item"> <input type="checkbox" id="track-sleep-desktop"> <label for="track-sleep-desktop">Dorm√≠ al menos 7 horas</label> </div>
                        <div class="tracker-item"> <input type="checkbox" id="track-fruit-desktop"> <label for="track-fruit-desktop">Com√≠ 5 porciones de verdura/fruta</label> </div>
                        <div class="tracker-item"> <input type="checkbox" id="track-stretch-desktop"> <label for="track-stretch-desktop">Hice estiramientos / movilidad</label> </div>
                        <div class="tracker-item"> <input type="checkbox" id="track-meditate-desktop"> <label for="track-meditate-desktop">Medit√© 10 minutos</label> </div>
                        <div class="tracker-item"> <input type="checkbox" id="track-supplement-desktop"> <label for="track-supplement-desktop">Tom√© mi suplemento (ej. prote√≠na)</label> </div>
                        <hr style="border-color:var(--glass); margin: 8px 0;">
                        <div id="tracker-custom-desktop"></div>

                        <hr style="border-color:var(--glass); margin: 12px 0;">
                        <div class="form-row"> <input type="number" id="track-calories-desktop" placeholder="Calor√≠as consumidas (ej: 1800)"> </div>
                        <button class="btn" style="width:100%" onclick="completeDay(true)">Completar D√≠a</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="page-diario" class="tab-page">
        <div class="content-stack">
            <div id="diario" class="card" data-aos="fade-up">
                <h3>Diario de Progreso</h3>
                <p>Aqu√≠ se guarda un resumen de tus actividades diarias y tu progreso de peso.</p>
                <div class="grid" style="align-items: start;">
                    <div class="col-8">
                        <h4>Historial de Actividad</h4>
                        <div id="journal-log" class="journal-log">
                            <p>A√∫n no hay entradas. Completa tu d√≠a para empezar.</p>
                        </div>
                    </div>
                    <div class="col-4">
                        <h4>Progreso de Peso</h4>
                        <canvas id="progressChart"></canvas>
                        <div style="margin-top:8px;display:flex;gap:8px">
                            <input id="pesoInput" type="number" placeholder="Peso (kg)" />
                            <button class="btn" onclick="addProgress()">A√±adir</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="page-planes" class="tab-page">
        <div class="content-stack">
            <div id="planes" class="card" data-aos="fade-up">
              <h3>Planes de Entrenamiento (Todos Gratis)</h3>
              <div class="plans">
                <div class="plan">
                  <h4>P√©rdida de peso</h4> <p>Entrenamientos HIIT, 4x...</p>
                  <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
                    <div class="price">Gratis</div> <button class="btn secondary" onclick="showPlanDetails('weight_loss')">Ver m√°s</button>
                  </div>
                </div>
                <div class="plan">
                  <h4>Aumento muscular</h4> <p>Fuerza y volumen, 5x...</p>
                  <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
                    <div class="price">Gratis</div> <button class="btn secondary" onclick="showPlanDetails('muscle_gain')">Ver m√°s</button>
                  </div>
                </div>
                <div class="plan">
                  <h4>Tonificaci√≥n</h4> <p>Combinaci√≥n cardio-fuerza, 3x...</p>
                  <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
                    <div class="price">Gratis</div> <button class="btn secondary" onclick="showPlanDetails('toning')">Ver m√°s</button>
                  </div>
                </div>
              </div>
            </div>
    
            <div id="dietas" class="card" data-aos="fade-up">
              <h3>Planes de Dieta</h3>
              <div class="diet-list">
                <div class="diet-card card" data-diet="balanced">
                  <div class="chart-wrap"><canvas id="chart-balanced"></canvas></div>
                  <div class="diet-info">
                    <h4>Balanceada</h4> <p>Macros: <span class="badge">P 30% ‚Ä¢ C 45% ‚Ä¢ G 25%</span></p>
                    <div style="margin-top:8px">
                      <button class="btn" onclick="selectDiet('Balanceada', 'balanced')">Seleccionar</button>
                      <button class="btn secondary" onclick="showDietDetails('balanced')">Detalles</button>
                    </div>
                  </div>
                </div>
                <div class="diet-card card" data-diet="keto">
                  <div class="chart-wrap"><canvas id="chart-keto"></canvas></div>
                  <div class="diet-info">
                    <h4>Cetog√©nica</h4> <p>Macros: <span class="badge">P 20% ‚Ä¢ C 10% ‚Ä¢ G 70%</span></p>
                    <div style="margin-top:8px">
                      <button class="btn" onclick="selectDiet('Cetog√©nica', 'keto')">Seleccionar</button>
                      <button class="btn secondary" onclick="showDietDetails('keto')">Detalles</button>
                    </div>
                  </div>
                </div>
                <div class="diet-card card" data-diet="vegan">
                  <div class="chart-wrap"><canvas id="chart-vegan"></canvas></div>
                  <div class="diet-info">
                    <h4>Vegana</h4> <p>Macros: <span class="badge">P 25% ‚Ä¢ C 55% ‚Ä¢ G 20%</span></p>
                    <div style="margin-top:8px">
                      <button class="btn" onclick="selectDiet('Vegana', 'vegan')">Seleccionar</button>
                      <button class="btn secondary" onclick="showDietDetails('vegan')">Detalles</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </div>
    </div>

    <div id="page-comunidad" class="tab-page">
        <div class="content-stack">
            <div class="card" data-aos="fade-up">
                <h3>Comunidad FitLifes¬°GO!</h3>
                <p><strong>¬°Esta es tu secci√≥n social!</strong> Aqu√≠ podr√°s ver los logros de otros usuarios, participar en retos virtuales y compartir tus avances. (Funci√≥n en desarrollo...)</p>
                <div style="padding:15px; border: 1px dashed var(--accent); border-radius:10px; margin-top:15px;">
                    <h4>Reto Semanal de Sentadillas</h4>
                    <p>√önete a la comunidad y completa 100 sentadillas en 5 d√≠as. üèãÔ∏è‚Äç‚ôÄÔ∏è</p>
                    <button class="btn secondary">Unirme al Reto (Simulado)</button>
                </div>
                <h4 style="margin-top:20px">Publicaciones Recientes</h4>
                <div style="background:var(--glass); padding:15px; border-radius:8px; margin-bottom:10px;">
                    <strong>@fitness_pro12:</strong> ¬°Logr√© mi objetivo de 50kg levantados en press banca! Gracias FitLifes¬°GO! üí™
                </div>
                <div style="background:var(--glass); padding:15px; border-radius:8px;">
                    <strong>@dieta_keto:</strong> Mi IMC baj√≥ de 28.1 a 27.9 esta semana. ¬°El gr√°fico de progreso ayuda mucho! üìâ
                </div>
            </div>
        </div>
    </div>

    <div id="page-perfil" class="tab-page">
        <div class="content-stack">
            
            <div id="profile-header-card" class="card" data-aos="fade-up">
                <input type="file" id="profile-pic-upload" hidden accept="image/*">
                <img id="profile-pic" src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png" alt="Foto de perfil" class="profile-image" title="Haz clic para cambiar la foto">
                <h2 id="profile-card-name">Cargando...</h2>
                <p>
                    <span id="profile-card-stats">
                        Altura: <strong id="profile-card-height">--</strong> cm ‚Ä¢ 
                        Peso: <strong id="profile-card-weight">--</strong> kg
                    </span><br>
                    Objetivo: <strong id="profile-card-goal">--</strong>
                </p>
                <button class="btn secondary" id="edit-profile-btn" style="width:100%; max-width: 250px;">Editar Perfil y M√©tricas</button>
            </div>

            <div id="calculadora" class="card" data-aos="fade-up">
              <h3>Mis M√©tricas</h3>
              <p>Edita tus m√©tricas aqu√≠. Se guardar√°n autom√°ticamente al hacer clic en "Guardar".</p>
              <div>
                <div class="form-row">
                  <input id="age" type="number" placeholder="Edad" />
                  <select id="sex" onchange="checkCustomGender('sex', 'custom-gender-wrapper')">
                      <option value="male">Hombre</option>
                      <option value="female">Mujer</option>
                      <option value="other">Otro</option>
                  </select>
                </div>
                <div id="custom-gender-wrapper" class="form-row" style="display:none; margin-top:-5px; margin-bottom:10px;">
                    <input id="custom-gender" type="text" placeholder="¬øC√≥mo te identificas? (opcional)">
                </div>
                <div class="form-row">
                  <input id="height" type="text" placeholder="Altura (cm o 1.72)" />
                  <input id="weight" type="number" placeholder="Peso (kg)" />
                </div>
                <div style="display:flex;gap:8px;margin-top:8px">
                  <button class="btn" onclick="calculateCalories()">Calcular TMB</button>
                  <button class="btn secondary" onclick="saveProfile()">Guardar M√©tricas</button>
                </div>
                <p style="margin-top:12px">Tu TMB estimada: <strong id="tmb">‚Äî</strong></p>
                <p>Calor√≠as objetivo: <strong id="targetCalories">‚Äî</strong></p>
              </div>
            </div>

            <div id="custom-tracker-settings" class="card" data-aos="fade-up">
                <h3>Objetivos Personalizados del Diario</h3>
                <p>Define hasta 3 objetivos para tu seguimiento diario. Se guardan al instante.</p>
                <div class="form-row">
                    <input id="custom-1" type="text" placeholder="Objetivo 1 (ej: Leer 10 p√°ginas)" onchange="saveCustomTrackers()">
                </div>
                <div class="form-row">
                    <input id="custom-2" type="text" placeholder="Objetivo 2 (ej: Llamar a mi madre)" onchange="saveCustomTrackers()">
                </div>
                <div class="form-row">
                    <input id="custom-3" type="text" placeholder="Objetivo 3 (ej: Preparar la comida de ma√±ana)" onchange="saveCustomTrackers()">
                </div>
            </div>

        </div>
    </div>
    
    <div id="page-info" class="tab-page">
        <div class="content-stack">
            <div class="card" data-aos="fade-up">
                <h3>Informaci√≥n y Ayuda</h3>
                <p>¬øNo sabes c√≥mo empezar? Vuelve a ver el tutorial.</p>
                <button class="btn" onclick="startTutorial()">Ver Mini-Tutorial</button>
            </div>
            
            <div id="contacto" class="card" data-aos="fade-up">
              <h3>Contacto</h3>
              <form onsubmit="event.preventDefault();alert('Mensaje enviado (simulado)')">
                <div class="form-row">
                  <input required placeholder="Nombre" />
                  <input required placeholder="Correo" type="email" />
                </div>
                <textarea required placeholder="Mensaje" style="width:100%;min-height:100px;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit"></textarea>
                <div style="margin-top:10px"><button class="btn">Enviar</button></div>
              </form>
            </div>
        
            <div id="creditos" class="card" data-aos="fade-up">
                <h3>Cr√©ditos</h3>
                <p><strong>Escuela:</strong> CBTis N. 132, Hermosillo Sonora M√©xico</p>
                <p><strong>Desarrolladores:</strong></p>
                <ul>
                    <li>Jonathan Alexis Payan Enriquez</li>
                    <li>Sebastian Teran Rubio</li>
                </ul>
                <p><strong>Desarrollador Principal:</strong> Jesus Abraham Lopez Gutierrez</p>
            </div>
        </div>
    </div>
  </main>

  <footer>
    <p>¬© 2025 FitLifes¬°GO! ‚Ä¢ CBTis Fit App ‚Ä¢ Pol√≠tica de Privacidad</p>
  </footer>

  <div class="mobile-tab-bar">
    <nav class="tab-bar-nav">
        <button id="nav-inicio" class="tab-btn active" onclick="showPage('page-inicio', this)">
            <i class="fa-solid fa-house"></i>
            <span>Inicio</span>
        </button>
        <button id="nav-diario" class="tab-btn" onclick="showPage('page-diario', this)">
            <i class="fa-solid fa-chart-line"></i>
            <span>Diario</span>
        </button>
        <button id="nav-planes" class="tab-btn" onclick="showPage('page-planes', this)">
            <i class="fa-solid fa-book-bookmark"></i>
            <span>Planes</span>
        </button>
        <button id="nav-comunidad" class="tab-btn" onclick="showPage('page-comunidad', this)">
            <i class="fa-solid fa-users"></i>
            <span>Comunidad</span>
        </button>
        <button id="nav-perfil" class="tab-btn" onclick="showPage('page-perfil', this)">
            <i class="fa-solid fa-user"></i>
            <span>Perfil</span>
        </button>
    </nav>
  </div>

  <div id="wizard-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-body" style="flex:1;">
        <div id="step-1" class="wizard-step active">
            <h2 class="modal-header" style="color:var(--accent); padding:0; border:0;">¬°Bienvenido a FitLifes¬°GO!</h2>
            <p>Vamos a configurar tu perfil. Esto solo tomar√° un minuto y nos ayudar√° a personalizar tu experiencia.</p>
            <div class="wizard-nav">
                <span></span> <button class="btn" onclick="nextStep(2)">Comenzar</button>
            </div>
        </div>
        <div id="step-2" class="wizard-step">
            <h2 class="modal-header" style="color:var(--accent); padding:0; border:0;">¬øCu√°l es tu objetivo principal?</h2>
            <div class="wizard-options">
                <div class="option" id="goal-lose" onclick="selectWizardOption('goal', 'lose')">Perder Peso</div>
                <div class="option" id="goal-maintain" onclick="selectWizardOption('goal', 'maintain')">Mantener Peso</div>
                <div class="option" id="goal-gain" onclick="selectWizardOption('goal', 'gain')">Ganar M√∫sculo</div>
            </div>
            <div class="wizard-nav">
                <button class="btn secondary" onclick="prevStep(1)">Atr√°s</button>
                <button class="btn" onclick="nextStep(3)">Siguiente</button>
            </div>
        </div>
        <div id="step-3" class="wizard-step">
            <h2 class="modal-header" style="color:var(--accent); padding:0; border:0;">Cu√©ntanos sobre ti</h2>
            <p>Usaremos esto para calcular tus calor√≠as, IMC y TMB.</p>
            <div class="form-row">
                <input id="wiz-name" type="text" placeholder="Tu Nombre" />
                <select id="wiz-sex" onchange="checkCustomGender('wiz-sex', 'wiz-custom-gender-wrapper')">
                    <option value="male">Hombre</option>
                    <option value="female">Mujer</option>
                    <option value="other">Otro</option>
                </select>
            </div>
            <div id="wiz-custom-gender-wrapper" class="form-row" style="display:none; margin-top:-5px; margin-bottom:10px;">
                <input id="wiz-custom-gender" type="text" placeholder="¬øC√≥mo te identificas? (opcional)">
            </div>
            <div class="form-row">
                <input id="wiz-age" type="number" placeholder="Edad" />
                <input id="wiz-height" type="text" placeholder="Altura (cm o 1.72)" />
                <input id="wiz-weight" type="number" placeholder="Peso (kg)" />
            </div>
            <div class="wizard-nav">
                <button class="btn secondary" onclick="prevStep(2)">Atr√°s</button>
                <button class="btn" onclick="nextStep(4)">Siguiente</button>
            </div>
        </div>
        <div id="step-4" class="wizard-step">
            <h2 class="modal-header" style="color:var(--accent); padding:0; border:0;">Tu Estilo de Vida</h2>
            <p>Nivel de Actividad F√≠sica:</p>
            <select id="wiz-activity" style="width:100%; margin-bottom: 12px;">
                <option value="1.2">Sedentario (poco o nada)</option>
                <option value="1.375">Ligero (1-3 d√≠as/semana)</option>
                <option value="1.55">Moderado (3-5 d√≠as/semana)</option>
                <option value="1.725">Activo (6-7 d√≠as/semana)</option>
                <option value="1.9">Muy activo (trabajo f√≠sico + ejercicio)</option>
            </select>
            <p>Preferencia de Dieta (Opcional):</p>
            <select id="wiz-diet" style="width:100%">
                <option value="">Ninguna en especial</option>
                <option value="balanced">Balanceada</option>
                <option value="keto">Cetog√©nica</option>
                <option value="vegan">Vegana</option>
            </select>
            <div class="wizard-nav">
                <button class="btn secondary" onclick="prevStep(3)">Atr√°s</button>
                <button class="btn" onclick="nextStep(5)">Siguiente</button>
            </div>
        </div>
        <div id="step-5" class="wizard-step">
            <h2 class="modal-header" style="color:var(--accent); padding:0; border:0;">Objetivos Adicionales</h2>
            <p>Define hasta 3 objetivos personales para hacerles seguimiento diario:</p>
            <div class="form-row">
                <input id="wiz-custom-1" type="text" placeholder="Objetivo 1 (ej: Leer 10 p√°ginas)">
            </div>
            <div class="form-row">
                <input id="wiz-custom-2" type="text" placeholder="Objetivo 2 (ej: Llamar a un amigo)">
            </div>
            <div class="form-row">
                <input id="wiz-custom-3" type="text" placeholder="Objetivo 3 (ej: Estudiar para el examen)">
            </div>
            <div class="wizard-nav">
                <button class="btn secondary" onclick="prevStep(4)">Atr√°s</button>
                <button class="btn" onclick="completeWizard()">Finalizar</button>
            </div>
        </div>
      </div>
    </div>
  </div>

  <div id="tutorial-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-body" style="flex:1; display: flex; flex-direction: column; justify-content: center;">
            <div id="tut-step-1" class="wizard-step active" style="text-align:center;">
                <i class="fa-solid fa-rocket" style="font-size:3rem; color:var(--accent); margin-bottom:10px;"></i>
                <h2 class="modal-header" style="color:var(--accent); padding:0; border:0; justify-content:center;">¬°Todo listo!</h2>
                <p>Te damos un tour r√°pido por tu nueva app.</p>
                <div class="wizard-nav">
                    <span></span> <button class="btn" onclick="showTutorialStep(2)">Siguiente</button>
                </div>
            </div>
            <div id="tut-step-2" class="wizard-step" style="text-align:center;">
                <i class="fa-solid fa-house" style="font-size:3rem; color:var(--accent); margin-bottom:10px;"></i>
                <h2 class="modal-header" style="color:var(--accent); padding:0; border:0; justify-content:center;">Pesta√±a "Inicio"</h2>
                <p>Aqu√≠ tienes tu vista principal: tu panel r√°pido (en escritorio), el registro de "Mi D√≠a" con **m√°s opciones** y el Asistente.</p>
                <div class="wizard-nav">
                    <button class="btn secondary" onclick="showTutorialStep(1)">Atr√°s</button>
                    <button class="btn" onclick="showTutorialStep(3)">Siguiente</button>
                </div>
            </div>
            <div id="tut-step-3" class="wizard-step" style="text-align:center;">
                <i class="fa-solid fa-chart-line" style="font-size:3rem; color:var(--accent); margin-bottom:10px;"></i>
                <h2 class="modal-header" style="color:var(--accent); padding:0; border:0; justify-content:center;">Pesta√±a "Diario"</h2>
                <p>Aqu√≠ ver√°s tu progreso. Revisa tu historial de actividades y mira c√≥mo avanza tu peso en el gr√°fico.</p>
                <div class="wizard-nav">
                    <button class="btn secondary" onclick="showTutorialStep(2)">Atr√°s</button>
                    <button class="btn" onclick="showTutorialStep(4)">Siguiente</button>
                </div>
            </div>
            <div id="tut-step-4" class="wizard-step" style="text-align:center;">
                <i class="fa-solid fa-book-bookmark" style="font-size:3rem; color:var(--accent); margin-bottom:10px;"></i>
                <h2 class="modal-header" style="color:var(--accent); padding:0; border:0; justify-content:center;">Pesta√±a "Planes"</h2>
                <p>Explora y selecciona los planes de entrenamiento y las dietas que quieras seguir. ¬°Todos son gratis!</p>
                <div class="wizard-nav">
                    <button class="btn secondary" onclick="showTutorialStep(3)">Atr√°s</button>
                    <button class="btn" onclick="showTutorialStep(5)">Siguiente</button>
                </div>
            </div>
            <div id="tut-step-5" class="wizard-step" style="text-align:center;">
                <i class="fa-solid fa-users" style="font-size:3rem; color:var(--accent); margin-bottom:10px;"></i>
                <h2 class="modal-header" style="color:var(--accent); padding:0; border:0; justify-content:center;">Pesta√±a "Comunidad"</h2>
                <p>Una nueva secci√≥n social para compartir logros y participar en retos. (Simulada por ahora).</p>
                <div class="wizard-nav">
                    <button class="btn secondary" onclick="showTutorialStep(4)">Atr√°s</button>
                    <button class="btn" onclick="showTutorialStep(6)">Siguiente</button>
                </div>
            </div>
            <div id="tut-step-6" class="wizard-step" style="text-align:center;">
                <i class="fa-solid fa-user" style="font-size:3rem; color:var(--accent); margin-bottom:10px;"></i>
                <h2 class="modal-header" style="color:var(--accent); padding:0; border:0; justify-content:center;">Pesta√±a "Perfil"</h2>
                <p>Aqu√≠ puedes ver y editar tus m√©tricas, ¬°y tambi√©n definir tus **objetivos de seguimiento personalizados**!</p>
                <div class="wizard-nav">
                    <button class="btn secondary" onclick="showTutorialStep(5)">Atr√°s</button>
                    <button class="btn" onclick="showTutorialStep(7)">Siguiente</button>
                </div>
            </div>
            <div id="tut-step-7" class="wizard-step" style="text-align:center;">
                <i class="fa-solid fa-circle-question" style="font-size:3rem; color:var(--accent); margin-bottom:10px;"></i>
                <h2 class="modal-header" style="color:var(--accent); padding:0; border:0; justify-content:center;">Pesta√±a "Info"</h2>
                <p>Si alguna vez te pierdes, aqu√≠ puedes volver a ver este tutorial, contactarnos o ver los cr√©ditos. ¬°Est√°s listo para empezar!</p>
                <div class="wizard-nav">
                    <button class="btn secondary" onclick="showTutorialStep(6)">Atr√°s</button>
                    <button class="btn" onclick="closeTutorial()">¬°Entendido!</button>
                </div>
            </div>
        </div>
    </div>
  </div>

  <div id="details-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header"> <h2 id="modal-title-dynamic"></h2> <button id="closeModal" class="modal-close">&times;</button> </div>
      <div id="modal-body-dynamic" class="modal-body"></div>
      <div id="modal-footer-dynamic" class="modal-footer"></div>
    </div>
  </div>

  <div id="mobile-menu-overlay" class="modal-overlay">
    <div class="mobile-menu-content">
        <button id="mobile-menu-close" class="modal-close">&times;</button>
        <h2>Ajustes</h2>
        <button id="mobile-theme-btn">Cambiar Tema</button>
        <button id="mobile-clear-data-btn">Borrar Todos Mis Datos</button>
    </div>
  </div>


<script>
  // ====================
  // Base de datos (Mock)
  // ====================
  const DATABASE = {
      plans: {
          'weight_loss': { title: 'Plan: P√©rdida de peso', details: `<h3>Rutina Semanal (Ejemplo)</h3><ul><li><strong>Lunes:</strong> HIIT Total (30 min)</li><li><strong>Mi√©rcoles:</strong> Foco Abdomen y Piernas (40 min)</li><li><strong>Viernes:</strong> HIIT Cardio Intenso (35 min)</li><li><strong>S√°bado:</strong> Full Body Strength (45 min)</li></ul>`},
          'muscle_gain': { title: 'Plan: Aumento muscular', details: `<h3>Rutina Semanal (Ejemplo)</h3><ul><li><strong>Lunes:</strong> Pecho y Tr√≠ceps</li><li><strong>Martes:</strong> Espalda y B√≠ceps</li><li><strong>Mi√©rcoles:</strong> Piernas</li><li><strong>Viernes:</strong> Hombros y Trapecio</li><li><strong>S√°bado:</strong> Full Body</li></ul>`},
          'toning': { title: 'Plan: Tonificaci√≥n', details: `<h3>Rutina Semanal (Ejemplo)</h3><ul><li><strong>D√≠a 1:</strong> Full Body A + 15 min Cardio</li><li><strong>D√≠a 3:</strong> Full Body B + 15 min HIIT</li><li><strong>D√≠a 5:</strong> Full Body C + 20 min Cardio</li></ul>`}
      },
      diets: {
          'balanced': { title: 'Dieta Balanceada', macros: 'P 30% ‚Ä¢ C 45% ‚Ä¢ G 25%', details: `<h3>Ejemplo de Men√∫ (1 D√≠a)</h3><ul><li><strong>Desayuno:</strong> Avena con frutas y prote√≠na.</li><li><strong>Comida:</strong> Pollo a la plancha con quinoa y ensalada.</li><li><strong>Cena:</strong> Salm√≥n al horno con batata y br√≥coli.</li></ul>`},
          'keto': { title: 'Dieta Cetog√©nica', macros: 'P 20% ‚Ä¢ C 10% ‚Ä¢ G 70%', details: `<h3>Ejemplo de Men√∫ (1 D√≠a)</h3><ul><li><strong>Desayuno:</strong> Huevos revueltos con aguacate.</li><li><strong>Comida:</strong> Ensalada de ternera, aceite de oliva y nueces.</li><li><strong>Cena:</strong> Muslos de pollo al curry con coliflor.</li></ul>`},
          'vegan': { title: 'Dieta Vegana', macros: 'P 25% ‚Ä¢ C 55% ‚Ä¢ G 20%', details: `<h3>Ejemplo de Men√∫ (1 D√≠a)</h3><ul><li><strong>Desayuno:</strong> Tofu revuelto con pan integral.</li><li><strong>Comida:</strong> Bol de garbanzos, lentejas y arroz.</li><li><strong>Cena:</strong> Curry de lentejas rojas y espinacas.</li></ul>`}
      }
  };

  // Variables globales
  let wizardData = { goal: 'maintain' };
  let areDietChartsInitialized = false;
  let isProgressChartInitialized = false;
  let progressChart;
  let chartBalanced, chartKeto, chartVegan;
  
  // ==================== AOS init ====================
  AOS.init({once:true, duration:700});

  // ====================
  // L√≥gica de Navegaci√≥n por Pesta√±as (Tabs)
  // ====================
  function showPage(pageId, navElement = null) {
      document.querySelectorAll('.tab-page').forEach(page => {
          page.classList.remove('active');
      });
      document.getElementById(pageId).classList.add('active');

      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      const mobileBtnId = 'nav-' + pageId.split('-')[1];
      const mobileBtn = document.getElementById(mobileBtnId);
      if (mobileBtn) mobileBtn.classList.add('active');

      document.querySelectorAll('.desktop-nav a').forEach(a => a.classList.remove('active'));
      if (navElement && navElement.tagName === 'A') {
          navElement.classList.add('active');
      } else {
          document.querySelectorAll('.desktop-nav a').forEach(a => {
              if (a.getAttribute('onclick').includes(pageId)) {
                  a.classList.add('active');
              }
          });
      }
      
      // INICIALIZACI√ìN DE GR√ÅFICOS (ARREGLO DE ERROR)
      if (pageId === 'page-diario' && !isProgressChartInitialized) {
          initProgressChart();
      }
      if (pageId === 'page-planes' && !areDietChartsInitialized) {
          initDietCharts();
      }
      
      window.scrollTo(0, 0);
  }


  // ====================
  // L√≥gica del Cuestionario (Wizard)
  // ====================
  const wizardModal = document.getElementById('wizard-modal');
  
  function showWizard() {
      wizardModal.classList.add('visible');
      goToStep(1);
  }
  function closeWizard() {
      wizardModal.classList.remove('visible');
  }
  function goToStep(stepNum) {
      document.querySelectorAll('#wizard-modal .wizard-step').forEach(s => s.classList.remove('active'));
      document.getElementById('step-' + stepNum).classList.add('active');
  }
  function nextStep(stepNum) { goToStep(stepNum); }
  function prevStep(stepNum) { goToStep(stepNum); }

  function selectWizardOption(key, value) {
      wizardData[key] = value;
      const group = key === 'goal' ? 'goal' : '';
      if(group) {
          document.querySelectorAll(`.wizard-options .option[id^="${group}-"]`).forEach(o => o.classList.remove('selected'));
          document.getElementById(`${group}-${value}`).classList.add('selected');
      }
  }

  function processHeight(heightStr) {
      let height = String(heightStr).replace(',', '.');
      if (height && parseFloat(height) > 0 && parseFloat(height) < 3) {
          height = (parseFloat(height) * 100).toFixed(0);
      }
      return height;
  }

  function completeWizard() {
      const name = document.getElementById('wiz-name').value;
      const age = document.getElementById('wiz-age').value;
      let height = processHeight(document.getElementById('wiz-height').value);
      const weight = document.getElementById('wiz-weight').value;
      const sex = document.getElementById('wiz-sex').value;
      const customGender = document.getElementById('wiz-custom-gender').value;
      const activity = document.getElementById('wiz-activity').value;
      const dietId = document.getElementById('wiz-diet').value;
      
      const custom1 = document.getElementById('wiz-custom-1').value.trim();
      const custom2 = document.getElementById('wiz-custom-2').value.trim();
      const custom3 = document.getElementById('wiz-custom-3').value.trim();


      if (!name || !age || !height || !weight) {
          return alert('Por favor, completa tu nombre, edad, altura y peso.');
      }

      localStorage.setItem('fitlife_user', JSON.stringify({ name }));
      const profile = { age, height, weight, sex, customGender, activity, goal: wizardData.goal };
      localStorage.setItem('fitlife_profile', JSON.stringify(profile));
      
      localStorage.setItem('fitlife_custom_trackers', JSON.stringify([custom1, custom2, custom3]));
      loadCustomTrackers(); // Actualiza los inputs de Perfil

      if(dietId) {
          const dietName = DATABASE.diets[dietId]?.title || 'Balanceada';
          selectDiet(dietName, dietId, true);
      }

      closeWizard();
      
      if (confirm("¬°Bienvenido, " + name + "! Tu perfil est√° configurado. ¬øQuieres ver un tour r√°pido de la app?")) {
          startTutorial();
      }
      
      loadProfile();
      welcomeAssistant();
  }

  // ====================
  // L√≥gica del Tutorial
  // ====================
  const tutorialModal = document.getElementById('tutorial-modal');
  function startTutorial() {
      tutorialModal.classList.add('visible');
      showTutorialStep(1);
  }
  function closeTutorial() {
      tutorialModal.classList.remove('visible');
  }
  function showTutorialStep(stepNum) {
      document.querySelectorAll('#tutorial-modal .wizard-step').forEach(s => s.classList.remove('active'));
      document.getElementById('tut-step-' + stepNum).classList.add('active');
  }

  // ====================
  // L√≥gica de G√©nero "Otro"
  // ====================
  function checkCustomGender(selectId, wrapperId) {
      const select = document.getElementById(selectId);
      const wrapper = document.getElementById(wrapperId);
      if (select.value === 'other') {
          wrapper.style.display = 'flex';
      } else {
          wrapper.style.display = 'none';
      }
  }

  // ====================
  // L√≥gica de Perfil y Carga
  // ====================
  function saveProfile(){
    const age = Number(document.getElementById('age').value);
    let height = processHeight(document.getElementById('height').value);
    const weight = Number(document.getElementById('weight').value);
    const sex = document.getElementById('sex').value;
    const customGender = document.getElementById('custom-gender').value;

    if(!age || !height || !weight){ return alert('Por favor, completa edad, altura y peso para guardar.'); }
    
    const p = JSON.parse(localStorage.getItem('fitlife_profile') || '{}');
    p.age = age;
    p.height = height;
    p.weight = weight;
    p.sex = sex;
    p.customGender = customGender;
    
    localStorage.setItem('fitlife_profile', JSON.stringify(p));
    alert('M√©tricas guardadas');
    loadProfile();
    document.getElementById('height').value = height;
  }
  
  function loadProfile() {
      loadProfilePic();
      
      const u = JSON.parse(localStorage.getItem('fitlife_user') || 'null');
      const p = JSON.parse(localStorage.getItem('fitlife_profile') || 'null');
      
      if (p && u) {
          document.getElementById('profile-card-name').textContent = u.name;
          document.getElementById('profile-card-height').textContent = p.height || '--';
          document.getElementById('profile-card-weight').textContent = p.weight || '--';
          document.getElementById('profile-card-goal').textContent = p.goal ? (p.goal.charAt(0).toUpperCase() + p.goal.slice(1)) : '--';

          document.getElementById('age').value = p.age; 
          document.getElementById('height').value = p.height; 
          document.getElementById('weight').value = p.weight; 
          document.getElementById('sex').value = p.sex; 
          
          document.getElementById('selectedGoal').textContent = p.goal ? (p.goal.charAt(0).toUpperCase() + p.goal.slice(1)) : 'No definido';
          
          checkCustomGender('sex', 'custom-gender-wrapper');
          if (p.sex === 'other' && p.customGender) {
              document.getElementById('custom-gender').value = p.customGender;
          }

          calculateIMC(); 
          calculateCalories(p.activity, p.goal);
          loadCustomTrackers(); // Carga las opciones personalizadas
      } else {
          document.getElementById('profile-card-name').textContent = 'Completa tu Perfil';
          document.getElementById('profile-card-height').textContent = '--';
          document.getElementById('profile-card-weight').textContent = '--';
          document.getElementById('profile-card-goal').textContent = '--';
      }

      const d = JSON.parse(localStorage.getItem('fitlife_selected_diet') || 'null'); 
      if(d) document.getElementById('selectedDiet').textContent = d.name;
      else document.getElementById('selectedDiet').textContent = 'Ninguna';

      const p_plan = JSON.parse(localStorage.getItem('fitlife_selected_plan') || 'null');
      if(p_plan) document.getElementById('selectedPlan').textContent = p_plan.name;
      else document.getElementById('selectedPlan').textContent = 'Ninguno';
  }

  // ====================
  // L√≥gica de Seguimiento Personalizado
  // ====================
  function saveCustomTrackers() {
      const c1 = document.getElementById('custom-1').value.trim();
      const c2 = document.getElementById('custom-2').value.trim();
      const c3 = document.getElementById('custom-3').value.trim();
      localStorage.setItem('fitlife_custom_trackers', JSON.stringify([c1, c2, c3]));
      renderCustomTrackers([c1, c2, c3]);
  }
  
  function loadCustomTrackers() {
      const customs = JSON.parse(localStorage.getItem('fitlife_custom_trackers') || '["", "", ""]');
      
      // Cargar en el panel de Perfil
      document.getElementById('custom-1').value = customs[0];
      document.getElementById('custom-2').value = customs[1];
      document.getElementById('custom-3').value = customs[2];
      
      // Renderizar en el Diario (Inicio)
      renderCustomTrackers(customs);
  }

  function renderCustomTrackers(customs) {
      const mobileContainer = document.getElementById('tracker-custom-mobile');
      const desktopContainer = document.getElementById('tracker-custom-desktop');
      mobileContainer.innerHTML = '';
      desktopContainer.innerHTML = '';
      
      customs.forEach((label, index) => {
          if (label) {
              const html = `<div class="tracker-item"> <input type="checkbox" id="track-custom-${index + 1}"> <label for="track-custom-${index + 1}">${label}</label> </div>`;
              mobileContainer.innerHTML += html;
              desktopContainer.innerHTML += `<div class="tracker-item"> <input type="checkbox" id="track-custom-${index + 1}-desktop"> <label for="track-custom-${index + 1}-desktop">${label}</label> </div>`;
          }
      });
  }

  // ====================
  // L√≥gica de Foto de Perfil
  // ====================
  const defaultProfilePic = "https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png";

  function initProfilePic() {
      const picElement = document.getElementById('profile-pic');
      const uploader = document.getElementById('profile-pic-upload');

      picElement.addEventListener('click', () => uploader.click());
      
      uploader.addEventListener('change', (event) => {
          const file = event.target.files[0];
          if (!file) return;
          
          const reader = new FileReader();
          reader.onload = (e) => {
              const dataUrl = e.target.result;
              try {
                  localStorage.setItem('fitlife_profile_pic', dataUrl);
                  loadProfilePic(dataUrl);
              } catch (error) {
                  console.error("Error guardando imagen:", error);
                  alert("Error: La imagen es demasiado grande (l√≠mite de 5MB). Por favor, elige una m√°s peque√±a.");
              }
          };
          reader.readAsDataURL(file);
      });
  }

  function loadProfilePic(src = null) {
      const picSrc = src || localStorage.getItem('fitlife_profile_pic') || defaultProfilePic;
      document.getElementById('profile-pic').src = picSrc;
  }

  // ====================
  // L√≥gica de C√°lculos
  // ====================
  function calculateIMC(){
    const p = JSON.parse(localStorage.getItem('fitlife_profile') || 'null');
    if (!p) {
        document.getElementById('imcValue').textContent = '‚Äî';
        return;
    }
    
    const w = parseFloat(p.weight);
    const h = parseFloat(p.height)/100;
    const el = document.getElementById('imcValue');
    if(!w || !h){ el.textContent = '‚Äî'; return }
    const imc = (w/(h*h)).toFixed(1);
    el.textContent = imc;
  }

  function calculateCalories(activity_val = null, goal_val = null){
    const age = Number(document.getElementById('age').value);
    const height = Number(document.getElementById('height').value);
    const weight = Number(document.getElementById('weight').value);
    const sex = document.getElementById('sex').value;
    
    const p = JSON.parse(localStorage.getItem('fitlife_profile') || 'null');
    const activity = activity_val || (p ? p.activity : 1.375);
    const goal = goal_val || (p ? p.goal : 'maintain');
    
    if(!age||!height||!weight){
        document.getElementById('tmb').textContent = '‚Äî';
        document.getElementById('targetCalories').textContent = '‚Äî';
        return;
    }
    let tmb = 0;
    if(sex==='male') tmb = 10*weight + 6.25*height - 5*age + 5;
    else tmb = 10*weight + 6.25*height - 5*age - 161; // 'female' o 'other'
    
    const maintenance = Math.round(tmb * activity);
    let target = maintenance;
    if(goal==='lose') target = Math.round(maintenance - 500);
    if(goal==='gain') target = Math.round(maintenance + 400);
    document.getElementById('tmb').textContent = Math.round(tmb) + ' kcal';
    document.getElementById('targetCalories').textContent = target + ' kcal';
  }

  // ====================
  // Gr√°ficos (Charts)
  // ====================
  function makeDoughnut(ctxId, data, labels, colors){
    const ctx = document.getElementById(ctxId)?.getContext('2d');
    if (!ctx) return null;
    return new Chart(ctx, {
      type:'doughnut',
      data:{labels:labels,datasets:[{data:data,backgroundColor:colors,borderWidth:2,borderColor:'rgba(0,0,0,0.15)'}]},
      options:{ responsive:true,maintainAspectRatio:false,cutout:'60%', plugins:{legend:{display:false},tooltip:{callbacks:{label:function(ctx){return ctx.label+': '+ctx.parsed + '%'}}}}}
    });
  }

  function initDietCharts() {
      if (areDietChartsInitialized) return;
      chartBalanced = makeDoughnut('chart-balanced',[30,45,25],['Prote√≠nas','Carbohidratos','Grasas'],['#3b82f6','#fb923c','#10b981']);
      chartKeto = makeDoughnut('chart-keto',[20,10,70],['Prote√≠nas','Carbohidratos','Grasas'],['#3b82f6','#fb923c','#10b981']);
      chartVegan = makeDoughnut('chart-vegan',[25,55,20],['Prote√≠nas','Carbohidratos','Grasas'],['#3b82f6','#fb923c','#10b981']);
      areDietChartsInitialized = true;
  }

  function initProgressChart() {
      if (isProgressChartInitialized) return;
      const ctxP = document.getElementById('progressChart')?.getContext('2d');
      if (!ctxP) return;
      
      const savedProgress = JSON.parse(localStorage.getItem('fitlife_progress') || '[]');
      progressChart = new Chart(ctxP, {
          type:'line',
          data:{
              labels:savedProgress.map(p=>p.date),
              datasets:[{label:'Peso (kg)',data:savedProgress.map(p=>p.weight),fill:false,tension:0.3, borderColor: 'var(--accent)'}]
          },
          options:{responsive:true,plugins:{legend:{display:false}}}
      });
      isProgressChartInitialized = true;
  }


  function addProgress(){
    if (!isProgressChartInitialized) {
        initProgressChart();
    }
    
    const val = Number(document.getElementById('pesoInput').value); 
    if(!val) return alert('Introduce un peso');
    
    const arr = JSON.parse(localStorage.getItem('fitlife_progress') || '[]');
    const now = new Date(); const label = now.toLocaleDateString();
    arr.push({date:label,weight:val});
    localStorage.setItem('fitlife_progress', JSON.stringify(arr));
    
    progressChart.data.labels.push(label); 
    progressChart.data.datasets[0].data.push(val); 
    progressChart.update();
    
    document.getElementById('pesoInput').value='';
    document.getElementById('weight').value = val;
    saveProfile();
  }
  
  // ====================
  // L√≥gica del Modal de Detalles
  // ====================
  const detailsModal = document.getElementById('details-modal');
  const modalTitle = document.getElementById('modal-title-dynamic');
  const modalBody = document.getElementById('modal-body-dynamic');
  const modalFooter = document.getElementById('modal-footer-dynamic');

  function closeDetailsModal() {
      detailsModal.classList.remove('visible');
  }
  document.getElementById('closeModal').onclick = closeDetailsModal;
  detailsModal.onclick = (e) => { 
      if(e.target === detailsModal) closeDetailsModal(); 
  }; 

  function showPlanDetails(planId) {
      const plan = DATABASE.plans[planId]; if (!plan) return;
      modalTitle.textContent = plan.title;
      modalBody.innerHTML = plan.details;
      modalFooter.innerHTML = `<button class="btn" onclick="selectPlan('${planId}', '${plan.title}')">Seleccionar este Plan</button>`;
      detailsModal.classList.add('visible');
  }

  function showDietDetails(dietId) {
      const diet = DATABASE.diets[dietId]; if (!diet) return;
      modalTitle.textContent = diet.title;
      modalBody.innerHTML = `
          <p><span class="badge">Macros: ${diet.macros}</span></p>
          <hr style="border-color:var(--glass); margin: 15px 0;">
          ${diet.details}
      `;
      modalFooter.innerHTML = `<button class="btn" onclick="selectDiet('${diet.title}', '${dietId}'); closeDetailsModal();">Seleccionar esta Dieta</button>`;
      detailsModal.classList.add('visible');
  }

  // ====================
  // Funciones de Selecci√≥n y Guardado
  // ====================
  function selectDiet(name, dietId, silent = false){
    document.getElementById('selectedDiet').textContent = name;
    localStorage.setItem('fitlife_selected_diet', JSON.stringify({id: dietId, name: name}));
    if(!silent) alert('Dieta "'+name+'" seleccionada y guardada.');
    loadProfile();
  }

  function selectPlan(planId, name){
    document.getElementById('selectedPlan').textContent = name;
    localStorage.setItem('fitlife_selected_plan', JSON.stringify({id: planId, name: name}));
    alert('Plan "'+name+'" seleccionado y guardado.');
    loadProfile();
    closeDetailsModal();
  }

  // ====================
  // Asistente de Chat
  // ====================
  const messagesEl = document.getElementById('messages');
  function appendMessage(text, who='bot'){
    const d = document.createElement('div'); d.className='msg '+(who==='user'?'user':'bot'); d.textContent=text; messagesEl.appendChild(d); messagesEl.scrollTop = messagesEl.scrollHeight;
  }
  function sendMessage(){
    const input = document.getElementById('chatInput'); const text = input.value.trim(); if(!text) return;
    appendMessage(text,'user'); input.value='';
    
    setTimeout(()=>{
      const t = text.toLowerCase();
      const p = JSON.parse(localStorage.getItem('fitlife_profile') || 'null');
      
      if (!p) {
          appendMessage("¬°Hola! Veo que no has completado tu perfil. Ve a la pesta√±a 'Perfil' o haz clic en 'Mi Perfil' para registrarte y poder ayudarte mejor.");
          return;
      }
      
      const goal = p.goal || 'maintain';

      if(t.includes('hola') || t.includes('buenos dias') || t.includes('buenas tardes')) {
          appendMessage('¬°Hola! ¬øEn qu√© puedo ayudarte hoy?');
      }
      else if(t.includes('gracias') || t.includes('grs')) {
          appendMessage('¬°De nada! Estoy aqu√≠ para ayudarte.');
      }
      else if(t.includes('dieta') || t.includes('recomi')) {
          if (goal === 'lose') appendMessage('Como tu objetivo es perder peso, te recomiendo una dieta con d√©ficit cal√≥rico. La Cetog√©nica o una Balanceada baja en calor√≠as pueden funcionar. Revisa la pesta√±a "Planes".');
          else if (goal === 'gain') appendMessage('Para ganar m√∫sculo, necesitas un super√°vit cal√≥rico y alta prote√≠na. La Dieta Balanceada, ajustando las porciones, es ideal.');
          else appendMessage('Para mantener, una Dieta Balanceada es perfecta. Aseg√∫rate de que tus calor√≠as de mantenimiento (TMB * actividad) coincidan con lo que comes.');
      }
      else if(t.includes('brazo') || t.includes('pecho')) {
          appendMessage('Para brazos: curls, dips y push-ups. Para pecho: press de banca y fondos. 3-4 series de 8-12 repeticiones. Revisa los "Planes" para una rutina completa.');
      }
      else if(t.includes('pierna') || t.includes('sentadilla')) {
          appendMessage('Las sentadillas, el peso muerto y las zancadas son clave para las piernas. Aseg√∫rate de mantener la espalda recta y bajar profundo.');
      }
      else if(t.includes('calor') || t.includes('calor√≠a')) {
          appendMessage('Puedes ver tus calor√≠as objetivo en la pesta√±a "Perfil", en la tarjeta "Mis M√©tricas". Est√°n calculadas seg√∫n tu perfil y objetivo.');
      }
      else if(t.includes('avena') || t.includes('pollo') || t.includes('huevo')) {
          appendMessage('Es un excelente alimento. La avena es un gran carbohidrato, mientras que el pollo y el huevo son fuentes fant√°sticas de prote√≠na.');
      }
      else if(t.includes('snack') || t.includes('entre comidas')) {
          appendMessage('Un buen snack podr√≠a ser un yogur griego, un pu√±ado de almendras, o una pieza de fruta. Depende de tu dieta y calor√≠as.');
      }
      else if(t.includes('no tengo ganas') || t.includes('cansado') || t.includes('desmotivado')) {
          appendMessage('¬°√Ånimo! La disciplina es lo que te lleva a la meta. A veces, lo m√°s dif√≠cil es empezar. ¬°Vamos, t√∫ puedes! Incluso un entrenamiento ligero es mejor que nada.');
      }
      else {
          appendMessage('No entend√≠ esa pregunta. Prueba preguntarme sobre dietas, ejercicios (ej: "brazos", "pierna") o calor√≠as.');
      }
    },600);
  }
  document.getElementById('chatInput').addEventListener('keydown', (e)=>{ if(e.key==='Enter') sendMessage(); });

  function welcomeAssistant() {
      messagesEl.innerHTML = '';
      const u = JSON.parse(localStorage.getItem('fitlife_user') || 'null');
      const p = JSON.parse(localStorage.getItem('fitlife_profile') || 'null');
      
      if (!p || !u) {
          appendMessage("¬°Hola! Soy el Asistente FitLifes¬°GO!. Parece que eres nuevo. Completa tu registro (en 'Mi Perfil' o en la pesta√±a 'Perfil') para que pueda ayudarte mejor.");
          return;
      }
      
      let name = u.name || 'Hola';
      let goal_msg = p.goal ? ` Veo que tu objetivo es ${p.goal === 'lose' ? 'perder peso' : (p.goal === 'gain' ? 'ganar m√∫sculo' : 'mantenerte')}.` : '';
      
      appendMessage(`${name} üëã. Soy tu asistente FitLifes¬°GO!${goal_msg} ¬øEn qu√© te ayudo hoy?`);
  }

  // ====================
  // L√≥gica del Diario
  // ====================
  const journalLogEl = document.getElementById('journal-log');
  
  function loadJournal() {
      const journal = JSON.parse(localStorage.getItem('fitlife_journal') || '[]');
      if (journal.length === 0) {
          journalLogEl.innerHTML = '<p>A√∫n no hay entradas. Completa tu d√≠a para empezar.</p>';
          return;
      }
      
      journalLogEl.innerHTML = '';
      journal.reverse().forEach(entry => {
          const entryEl = document.createElement('div');
          entryEl.className = 'log-entry';
          let summary = `<ul>`;
          
          if (entry.workout) summary += `<li>‚úÖ Entrenaste.</li>`;
          if (entry.diet) summary += `<li>‚úÖ Seguiste tu dieta.</li>`;
          if (entry.water) summary += `<li>‚úÖ Bebiste 2L de agua.</li>`;
          // Nuevas opciones fijas
          if (entry.sleep) summary += `<li>‚úÖ Dormiste 7+ horas.</li>`;
          if (entry.fruit) summary += `<li>‚úÖ Comiste 5 porciones de verdura/fruta.</li>`;
          if (entry.stretch) summary += `<li>‚úÖ Hiciste estiramientos.</li>`;
          if (entry.meditate) summary += `<li>‚úÖ Meditaste.</li>`;
          if (entry.supplement) summary += `<li>‚úÖ Tomaste tu suplemento.</li>`;
          
          // Opciones personalizadas
          const customs = JSON.parse(localStorage.getItem('fitlife_custom_trackers') || '["", "", ""]');
          customs.forEach((label, index) => {
              const key = `custom${index + 1}`;
              if (label && entry[key]) {
                  summary += `<li>‚úÖ ${label}</li>`;
              }
          });
          
          if (entry.calories) summary += `<li>Consumiste aprox. <strong>${entry.calories} kcal</strong>.</li>`;
          
          summary += `</ul>`;
          entryEl.innerHTML = `<div class="log-entry-date">${entry.date}</div>${summary}`;
          journalLogEl.appendChild(entryEl);
      });
  }

  function completeDay(isDesktop = false) {
      let water, workout, diet, calories, sleep, fruit, stretch, meditate, supplement, custom1, custom2, custom3;
      
      const customs = JSON.parse(localStorage.getItem('fitlife_custom_trackers') || '["", "", ""]');
      
      if(isDesktop) {
          water = document.getElementById('track-water-desktop').checked;
          workout = document.getElementById('track-workout-desktop').checked;
          diet = document.getElementById('track-diet-desktop').checked;
          calories = document.getElementById('track-calories-desktop').value;
          // Nuevas opciones
          sleep = document.getElementById('track-sleep-desktop').checked;
          fruit = document.getElementById('track-fruit-desktop').checked;
          stretch = document.getElementById('track-stretch-desktop').checked;
          meditate = document.getElementById('track-meditate-desktop').checked;
          supplement = document.getElementById('track-supplement-desktop').checked;
          // Personalizadas
          custom1 = customs[0] ? document.getElementById('track-custom-1-desktop').checked : false;
          custom2 = customs[1] ? document.getElementById('track-custom-2-desktop').checked : false;
          custom3 = customs[2] ? document.getElementById('track-custom-3-desktop').checked : false;
      } else {
          water = document.getElementById('track-water').checked;
          workout = document.getElementById('track-workout').checked;
          diet = document.getElementById('track-diet').checked;
          calories = document.getElementById('track-calories').value;
          // Nuevas opciones
          sleep = document.getElementById('track-sleep').checked;
          fruit = document.getElementById('track-fruit').checked;
          stretch = document.getElementById('track-stretch').checked;
          meditate = document.getElementById('track-meditate').checked;
          supplement = document.getElementById('track-supplement').checked;
          // Personalizadas
          custom1 = customs[0] ? document.getElementById('track-custom-1').checked : false;
          custom2 = customs[1] ? document.getElementById('track-custom-2').checked : false;
          custom3 = customs[2] ? document.getElementById('track-custom-3').checked : false;
      }
      
      const journal = JSON.parse(localStorage.getItem('fitlife_journal') || '[]');
      const today = new Date().toLocaleDateString();

      const existingIndex = journal.findIndex(entry => entry.date === today);
      const newEntry = { date: today, water, workout, diet, calories, sleep, fruit, stretch, meditate, supplement, custom1, custom2, custom3 };

      if (existingIndex > -1) journal[existingIndex] = newEntry;
      else journal.push(newEntry);

      localStorage.setItem('fitlife_journal', JSON.stringify(journal));
      alert('¬°D√≠a completado! Tu progreso ha sido guardado en el diario.');

      // Limpiar y resetear
      const cleanupIds = [
          'track-water', 'track-workout', 'track-diet', 'track-calories',
          'track-water-desktop', 'track-workout-desktop', 'track-diet-desktop', 'track-calories-desktop',
          'track-sleep', 'track-fruit', 'track-stretch', 'track-meditate', 'track-supplement',
          'track-sleep-desktop', 'track-fruit-desktop', 'track-stretch-desktop', 'track-meditate-desktop', 'track-supplement-desktop',
      ];
      cleanupIds.forEach(id => {
          const el = document.getElementById(id);
          if (el) el[el.type === 'checkbox' ? 'checked' : 'value'] = el.type === 'checkbox' ? false : '';
      });
      // Limpiar personalizados (usando selectores CSS para los que existen)
      document.querySelectorAll('#tracker-custom-mobile input[type="checkbox"]').forEach(el => el.checked = false);
      document.querySelectorAll('#tracker-custom-desktop input[type="checkbox"]').forEach(el => el.checked = false);

      loadJournal();
  }

  // ====================
  // L√≥gica de Carga Inicial y Controles
  // ====================
  
  // ARREGLO: Mover todos los event listeners a la carga de la ventana
  window.addEventListener('load', ()=>{
    
    // --- 1. Definir Elementos ---
    const themeToggle = document.getElementById('themeToggle');
    const openRegister = document.getElementById('openRegister');
    const editProfileBtn = document.getElementById('edit-profile-btn');
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenuClose = document.getElementById('mobile-menu-close');
    const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
    const mobileThemeBtn = document.getElementById('mobile-theme-btn');
    const mobileClearDataBtn = document.getElementById('mobile-clear-data-btn');

    // --- 2. Cargar Estado Inicial ---
    const savedTheme = localStorage.getItem('fitlife_theme') || 'dark';
    document.body.setAttribute('data-theme', savedTheme);
    themeToggle.innerHTML = savedTheme === 'light' ? '<i class="fa-solid fa-sun"></i>' : '<i class="fa-solid fa-moon"></i>';
    mobileThemeBtn.innerHTML = savedTheme === 'light' ? 'Tema: Claro' : 'Tema: Oscuro';

    const p = JSON.parse(localStorage.getItem('fitlife_profile') || 'null');
    if(p) {
        loadProfile();
        closeWizard();
    } else {
        showWizard();
    }
    
    loadJournal();
    loadCustomTrackers(); // Asegura que los rastreadores est√©n cargados
    welcomeAssistant();
    initProfilePic();

    showPage('page-inicio', document.querySelector('.desktop-nav a'));

    // --- 3. Asignar Event Listeners ---
    
    // Control de Tema
    function toggleTheme() {
      const el = document.body;
      const cur = el.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      el.setAttribute('data-theme', cur);
      localStorage.setItem('fitlife_theme', cur);
      themeToggle.innerHTML = cur === 'light' ? '<i class="fa-solid fa-sun"></i>' : '<i class="fa-solid fa-moon"></i>';
      mobileThemeBtn.innerHTML = cur === 'light' ? 'Tema: Claro' : 'Tema: Oscuro';
    }
    themeToggle.addEventListener('click', toggleTheme);
    mobileThemeBtn.addEventListener('click', toggleTheme);

    // Control de Perfil
    function openProfileEditor() {
        // Cargar datos del perfil en el wizard (para edici√≥n)
        const p = JSON.parse(localStorage.getItem('fitlife_profile') || 'null');
        if (p) {
            document.getElementById('wiz-name').value = JSON.parse(localStorage.getItem('fitlife_user') || '{}').name || '';
            document.getElementById('wiz-sex').value = p.sex;
            document.getElementById('wiz-age').value = p.age;
            document.getElementById('wiz-height').value = p.height;
            document.getElementById('wiz-weight').value = p.weight;
            document.getElementById('wiz-activity').value = p.activity;
            selectWizardOption('goal', p.goal);
            
            checkCustomGender('wiz-sex', 'wiz-custom-gender-wrapper');
            if (p.sex === 'other' && p.customGender) {
                document.getElementById('wiz-custom-gender').value = p.customGender;
            }
            const d = JSON.parse(localStorage.getItem('fitlife_selected_diet') || 'null');
            if (d) document.getElementById('wiz-diet').value = d.id;
        }
        // Cargar objetivos personalizados en el wizard
        const customs = JSON.parse(localStorage.getItem('fitlife_custom_trackers') || '["", "", ""]');
        document.getElementById('wiz-custom-1').value = customs[0];
        document.getElementById('wiz-custom-2').value = customs[1];
        document.getElementById('wiz-custom-3').value = customs[2];

        showWizard();
    }
    openRegister.addEventListener('click', openProfileEditor);
    editProfileBtn.addEventListener('click', () => {
        const metricsCard = document.getElementById('calculadora');
        showPage('page-perfil', document.getElementById('nav-perfil'));
        metricsCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
        metricsCard.style.transition = 'all 0.3s ease';
        metricsCard.style.boxShadow = '0 0 25px var(--accent)';
        setTimeout(() => {
            metricsCard.style.boxShadow = '0 6px 22px rgba(2,6,23,0.25)';
        }, 1500);
    });
    
    // Asigna el evento para el bot√≥n en el men√∫ m√≥vil (ahora solo existe en el men√∫ de hamburguesa)
    const mobileProfileBtn = document.getElementById('mobile-profile-btn');
    if (mobileProfileBtn) {
        mobileProfileBtn.addEventListener('click', () => {
            closeMobileMenu();
            openProfileEditor();
        });
    }

    // L√≥gica del Men√∫ M√≥vil (Hamburguesa)
    function openMobileMenu() {
        mobileMenuOverlay.classList.add('visible');
    }
    function closeMobileMenu() {
        mobileMenuOverlay.classList.remove('visible');
    }
    mobileMenuBtn.addEventListener('click', openMobileMenu);
    mobileMenuClose.addEventListener('click', closeMobileMenu);
    mobileMenuOverlay.addEventListener('click', (e) => {
        if (e.target === mobileMenuOverlay) {
            closeMobileMenu();
        }
    });
    mobileClearDataBtn.addEventListener('click', () => {
        closeMobileMenu();
        if(confirm('¬øEst√°s seguro de que quieres borrar todos tus datos guardados (perfil, progreso, diario)?')){
            localStorage.clear();
            location.reload();
        }
    });
    
  }); // Fin del window.addEventListener('load')

</script>
</body>
</html>
